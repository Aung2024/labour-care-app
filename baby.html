<!DOCTYPE html>
<html lang="en">
<head>
  <title>Birth Record - Maternal & Child Health Care System</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    :root {
      --primary-color: #10b981;
      --secondary-color: #059669;
      --accent-color: #34d399;
      --light-bg: #f0fdf4;
      --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    body {
      background: var(--light-bg);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .header-section {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      padding: 2rem 0;
      margin-bottom: 2rem;
    }
    .birth-form-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    
    
    .form-section {
      background: white;
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      border: 1px solid #e5e7eb;
    }
    
    .form-section h3 {
      color: #374151;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #10b981;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .form-section h3 i {
      color: #10b981;
    }
    
    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #374151;
    }
    
    .form-control {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 1rem;
      transition: all 0.3s ease;
    }
    
    .form-control:focus {
      outline: none;
      border-color: #10b981;
      box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
    }
    
    .form-control:invalid {
      border-color: #ef4444;
    }
    
    .required-field::after {
      content: " *";
      color: #ef4444;
      font-weight: bold;
    }
    
    .action-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 30px;
      padding: 20px;
      background: #f9fafb;
      border-radius: 12px;
    }
    
    .btn-save-birth {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      border: none;
      padding: 15px 40px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
    }
    
    .btn-save-birth:hover {
      background: linear-gradient(135deg, #059669, #047857);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
    }
    
    .btn-back {
      background: #6b7280;
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .btn-back:hover {
      background: #4b5563;
      transform: translateY(-1px);
    }
    
    .success-message {
      display: none;
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      margin: 20px 0;
      box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
    }
    
    .success-message i {
      font-size: 2rem;
      margin-bottom: 10px;
      display: block;
    }
    
    .patient-info-simple {
      background: #f3f4f6;
      padding: 15px 20px;
      border-radius: 8px;
      margin-bottom: 25px;
      border-left: 4px solid #10b981;
    }
    
    .patient-info-simple h4 {
      color: #374151;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1.2rem;
    }

    /* Complications & E-MOTIVE Styling */
    .section-subtitle {
      color: #374151;
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid #e5e7eb;
    }

    .complications-card {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 1.5rem;
    }

    .hemorrhage-alert {
      background: linear-gradient(135deg, #fee2e2, #fecaca);
      border: 1px solid #f87171;
      border-radius: 8px;
      padding: 1rem;
      color: #991b1b;
      text-align: center;
    }

    .hemorrhage-alert i {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
      display: block;
    }

    .hemorrhage-alert strong {
      display: block;
      margin-bottom: 0.5rem;
      font-size: 1.1rem;
    }

    .hemorrhage-alert p {
      margin: 0;
      font-size: 0.9rem;
    }

    /* Vital Signs Grid */
    .vital-signs-set {
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      margin-bottom: 1rem;
      background: white;
    }

    .vital-signs-header {
      background: #f8fafc;
      padding: 0.75rem 1rem;
      border-bottom: 1px solid #e2e8f0;
      border-radius: 8px 8px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .vital-set-title {
      margin: 0;
      color: #374151;
      font-size: 0.95rem;
      font-weight: 600;
    }

    .remove-vital-set {
      background: #fee2e2;
      border: 1px solid #fca5a5;
      color: #dc2626;
      border-radius: 4px;
      padding: 0.25rem 0.5rem;
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .remove-vital-set:hover {
      background: #fecaca;
      border-color: #f87171;
    }

    .vital-signs-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1rem;
      padding: 1rem;
    }

    .vital-sign-item {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 1rem;
    }

    .vital-sign-item label {
      display: block;
      font-weight: 600;
      color: #374151;
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
    }

    .vital-input-group {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .vital-at {
      font-size: 0.8rem;
      color: #6b7280;
      font-weight: 500;
    }

    .time-input {
      flex: 0 0 120px;
      font-size: 0.9rem;
    }

    /* E-MOTIVE Bundle Styling */
    .emotive-bundle {
      background: #f0f9ff;
      border: 1px solid #bae6fd;
      border-radius: 12px;
      padding: 1.5rem;
    }

    /* Best Practices Bundle Styling */
    .best-practices-bundle {
      background: #fdf4ff;
      border: 1px solid #e879f9;
      border-radius: 12px;
      padding: 1.5rem;
    }

    .emotive-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 1rem;
    }

    .emotive-item {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 1rem;
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      transition: all 0.3s ease;
    }

    .emotive-item:hover {
      border-color: #10b981;
      box-shadow: 0 2px 8px rgba(16, 185, 129, 0.1);
    }

    .emotive-checkbox {
      flex-shrink: 0;
      margin-top: 0.25rem;
    }

    .emotive-content {
      flex: 1;
      display: flex;
      gap: 0.75rem;
      align-items: flex-start;
    }

    .emotive-letter {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.1rem;
      flex-shrink: 0;
    }

    .emotive-description {
      flex: 1;
    }

    .emotive-description strong {
      display: block;
      color: #374151;
      margin-bottom: 0.25rem;
      font-size: 0.95rem;
    }

    .emotive-description p {
      color: #6b7280;
      font-size: 0.8rem;
      margin: 0 0 0.75rem 0;
      line-height: 1.3;
    }

    .duration-input {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .duration-input .form-control {
      flex: 1;
      font-size: 0.9rem;
      padding: 0.375rem 0.75rem;
    }

    .duration-unit {
      font-size: 0.8rem;
      color: #6b7280;
      font-weight: 500;
    }

    /* Custom Checkbox Styling */
    .custom-checkbox {
      display: none;
    }

    .checkbox-label {
      cursor: pointer;
      display: block;
      position: relative;
      margin: 0;
    }

    .checkmark {
      display: block;
      width: 20px;
      height: 20px;
      background: white;
      border: 2px solid #d1d5db;
      border-radius: 4px;
      position: relative;
      transition: all 0.3s ease;
    }

    .checkmark:after {
      content: '';
      position: absolute;
      display: none;
      left: 6px;
      top: 2px;
      width: 6px;
      height: 10px;
      border: solid white;
      border-width: 0 2px 2px 0;
      transform: rotate(45deg);
    }

    .custom-checkbox:checked + .checkbox-label .checkmark {
      background: #10b981;
      border-color: #10b981;
    }

    .custom-checkbox:checked + .checkbox-label .checkmark:after {
      display: block;
    }

    .checkbox-label:hover .checkmark {
      border-color: #10b981;
      box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.1);
    }

    /* Collapse Icon Styling */
    .collapse-icon {
      transition: transform 0.3s ease;
      font-size: 0.8rem;
    }
    
    .collapsed .collapse-icon {
      transform: rotate(-90deg);
    }
    
    .btn-link {
      color: var(--primary-color);
      text-decoration: none;
    }
    
    .btn-link:hover {
      color: var(--secondary-color);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .vital-signs-grid {
        grid-template-columns: 1fr;
      }
      
      .emotive-grid {
        grid-template-columns: 1fr;
      }
      
      .vital-input-group {
        flex-direction: column;
        align-items: stretch;
        gap: 0.5rem;
      }
      
      .vital-at {
        text-align: center;
      }
      
      .time-input {
        flex: 1;
      }
    }

    .footer {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      color: #374151;
      text-align: center;
      padding: 2rem;
      margin-top: 2rem;
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    /* Language Switcher */
    .language-switcher {
      display: flex;
      gap: 0.25rem;
      align-items: center;
      margin-right: 1rem;
    }

    .language-btn {
      padding: 0.375rem 0.75rem;
      font-size: 0.875rem;
      border-radius: 8px;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 0.25rem;
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      cursor: pointer;
    }

    .language-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      border-color: rgba(255, 255, 255, 0.5);
    }

    .language-btn.active {
      background: rgba(255, 255, 255, 0.4);
      border-color: rgba(255, 255, 255, 0.6);
      font-weight: 600;
    }

    .flag-icon {
      font-size: 1rem;
    }

    @media (max-width: 768px) {
      .language-switcher {
        margin-right: 0.5rem;
      }
    }
  </style>
  
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="js/firebase.js"></script>

</head>
<body>
  <!-- Header Section -->
  <div class="header-section">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-8">
          <h1 class="mb-2">
            <i class="fas fa-baby me-3"></i>
            <span class="lang-text" data-en="Birth Record" data-my="·Äô·ÄΩ·Ä±·Ä∏·Äñ·ÄΩ·Ä¨·Ä∏·Äô·Äæ·ÄØ ·Äô·Äæ·Äê·Ä∫·Äê·Äô·Ä∫·Ä∏">Birth Record</span>
          </h1>
      </div>
        <div class="col-md-4 text-end">
          <div class="d-flex align-items-center justify-content-end gap-2">
            <!-- Language Switcher -->
            <div class="language-switcher">
              <button type="button" class="btn btn-sm language-btn active" data-lang="en" title="English">
                <span class="flag-icon">üá¨üáß</span> ENG
              </button>
              <button type="button" class="btn btn-sm language-btn" data-lang="my" title="·Äô·Äº·Äî·Ä∫·Äô·Ä¨">
                <span class="flag-icon">üá≤üá≤</span> MM
              </button>
            </div>
            <a href="patient-care-hub.html" class="btn btn-outline-light btn-sm">
              <i class="fas fa-arrow-left me-2"></i><span class="lang-text" data-en="Back to Hub" data-my="Hub ·Äû·Ä≠·ÄØ·Ä∑ ·Äï·Äº·Äî·Ä∫·Äû·ÄΩ·Ä¨·Ä∏·Äõ·Äî·Ä∫">Back to Hub</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="main-container">
    <div class="birth-form-container">

      <!-- Patient Information Display -->
      <div class="patient-info-simple">
        <h4><i class="fas fa-user-injured"></i> <span id="patientName">Loading...</span></h4>
      </div>

      <!-- Birth Information Form -->
      <form id="birthForm" onsubmit="saveBirthRecord(event)">
        <!-- Baby Information Section -->
        <div class="form-section">
          <h3>
            <i class="fas fa-baby"></i> <span class="lang-text" data-en="Baby Information" data-my="·ÄÄ·Äú·Ä±·Ä∏ ·Ä°·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äú·ÄÄ·Ä∫">Baby Information</span>
            <button class="btn btn-link p-0 ms-2" type="button" data-bs-toggle="collapse" data-bs-target="#babyInfoCollapse" aria-expanded="true" aria-controls="babyInfoCollapse">
              <i class="fas fa-chevron-down collapse-icon"></i>
            </button>
          </h3>
          <div class="collapse show" id="babyInfoCollapse">
          
          <div class="form-row">
            <div class="form-group">
              <label for="babyName" class="lang-text" data-en="Baby's Name" data-my="·ÄÄ·Äú·Ä±·Ä∏·Åè ·Ä°·Äô·Ää·Ä∫">Baby's Name</label>
              <input type="text" id="babyName" name="babyName" class="form-control" placeholder="Enter baby's name">
            </div>
            <div class="form-group">
              <label for="babyGender" class="lang-text" data-en="Gender" data-my="·Äú·Ä≠·ÄÑ·Ä∫">Gender</label>
              <select id="babyGender" name="babyGender" class="form-control">
                <option value=""><span class="lang-text" data-en="Select gender" data-my="·Äú·Ä≠·ÄÑ·Ä∫ ·Äõ·ÄΩ·Ä±·Ä∏·ÄÅ·Äª·Äö·Ä∫·Äõ·Äî·Ä∫">Select gender</span></option>
                <option value="Male" class="lang-text" data-en="Male" data-my="·ÄÄ·Äª·Ä¨·Ä∏">Male</option>
                <option value="Female" class="lang-text" data-en="Female" data-my="·Äô">Female</option>
              </select>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="birthTime" class="lang-text" data-en="Birth Time" data-my="·Äô·ÄΩ·Ä±·Ä∏·Äñ·ÄΩ·Ä¨·Ä∏·Äû·Ää·Ä∑·Ä∫ ·Ä°·ÄÅ·Äª·Ä≠·Äî·Ä∫">Birth Time</label>
              <input type="datetime-local" id="birthTime" name="birthTime" class="form-control">
            </div>
            <div class="form-group">
              <label for="birthWeight" class="lang-text" data-en="Birth Weight (Lb)" data-my="·Äô·ÄΩ·Ä±·Ä∏·Äñ·ÄΩ·Ä¨·Ä∏·Äû·Ää·Ä∑·Ä∫ ·Ä°·Äú·Ä±·Ä∏·ÄÅ·Äª·Ä≠·Äî·Ä∫ (·Äï·Ä±·Ä´·ÄÑ·Ä∫)">Birth Weight (Lb)</label>
              <input type="number" id="birthWeight" name="birthWeight" class="form-control" min="1" max="20" step="0.1" placeholder="e.g., 7.1">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="birthLength" class="lang-text" data-en="Birth Length (cm)" data-my="·Äô·ÄΩ·Ä±·Ä∏·Äñ·ÄΩ·Ä¨·Ä∏·Äû·Ää·Ä∑·Ä∫ ·Ä°·Äõ·Ä∫·Ä°·Äô·Äº·ÄÑ·Ä∑·Ä∫ (·ÄÖ·ÄÑ·Ä∫·Äê·ÄÆ·Äô·ÄÆ·Äê·Ä¨)">Birth Length (cm)</label>
              <input type="number" id="birthLength" name="birthLength" class="form-control" min="20" max="70" step="0.1" placeholder="e.g., 50.5">
            </div>
            <div class="form-group">
              <label for="headCircumference" class="lang-text" data-en="Head Circumference (cm)" data-my="·Ä¶·Ä∏·ÄÅ·Ä±·Ä´·ÄÑ·Ä∫·Ä∏ ·Äï·Äê·Ä∫·Äú·Ää·Ä∫ (·ÄÖ·ÄÑ·Ä∫·Äê·ÄÆ·Äô·ÄÆ·Äê·Ä¨)">Head Circumference (cm)</label>
              <input type="number" id="headCircumference" name="headCircumference" class="form-control" min="20" max="50" step="0.1" placeholder="e.g., 35.2">
            </div>
          </div>
          </div>
        </div>

        <!-- Birth Details Section -->
        <div class="form-section">
          <h3>
            <i class="fas fa-calendar-check"></i> <span class="lang-text" data-en="Birth Details" data-my="·Äô·ÄΩ·Ä±·Ä∏·Äñ·ÄΩ·Ä¨·Ä∏·Äô·Äæ·ÄØ ·Ä°·Äû·Ä±·Ä∏·ÄÖ·Ä≠·Äê·Ä∫">Birth Details</span>
            <button class="btn btn-link p-0 ms-2" type="button" data-bs-toggle="collapse" data-bs-target="#birthDetailsCollapse" aria-expanded="true" aria-controls="birthDetailsCollapse">
              <i class="fas fa-chevron-down collapse-icon"></i>
            </button>
          </h3>
          <div class="collapse show" id="birthDetailsCollapse">
          
          <div class="form-row">
            <div class="form-group">
              <label for="birthPlace" class="lang-text" data-en="Birth Place" data-my="·Äô·ÄΩ·Ä±·Ä∏·Äñ·ÄΩ·Ä¨·Ä∏·Äû·Ää·Ä∑·Ä∫ ·Äî·Ä±·Äõ·Ä¨">Birth Place</label>
              <input type="text" id="birthPlace" name="birthPlace" class="form-control" placeholder="e.g., Home, Clinic, Hospital">
            </div>
            <div class="form-group">
              <label for="deliveryMethod" class="lang-text" data-en="Delivery Method" data-my="·Äô·ÄΩ·Ä±·Ä∏·Äñ·ÄΩ·Ä¨·Ä∏·Äî·Ää·Ä∫·Ä∏·Äú·Äô·Ä∫·Ä∏">Delivery Method</label>
              <select id="deliveryMethod" name="deliveryMethod" class="form-control">
                <option value=""><span class="lang-text" data-en="Select delivery method" data-my="·Äô·ÄΩ·Ä±·Ä∏·Äñ·ÄΩ·Ä¨·Ä∏·Äî·Ää·Ä∫·Ä∏·Äú·Äô·Ä∫·Ä∏ ·Äõ·ÄΩ·Ä±·Ä∏·ÄÅ·Äª·Äö·Ä∫·Äõ·Äî·Ä∫">Select delivery method</span></option>
                <option value="Normal Vaginal Delivery" class="lang-text" data-en="Normal Vaginal Delivery" data-my="·Äï·ÄØ·Ä∂·Äô·Äæ·Äî·Ä∫ ·Äô·ÄΩ·Ä±·Ä∏·Äñ·ÄΩ·Ä¨·Ä∏·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏">Normal Vaginal Delivery</option>
                <option value="Assisted Vaginal Delivery" class="lang-text" data-en="Assisted Vaginal Delivery" data-my="·Ä°·ÄÄ·Ä∞·Ä°·Ää·ÄÆ·Äñ·Äº·ÄÑ·Ä∑·Ä∫ ·Äô·ÄΩ·Ä±·Ä∏·Äñ·ÄΩ·Ä¨·Ä∏·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏">Assisted Vaginal Delivery</option>
                <option value="Cesarean Section" class="lang-text" data-en="Cesarean Section" data-my="·ÄÅ·ÄΩ·Ä≤·ÄÖ·Ä≠·Äê·Ä∫·Äô·ÄΩ·Ä±·Ä∏·Äñ·ÄΩ·Ä¨·Ä∏·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏">Cesarean Section</option>
                <option value="Vacuum Extraction" class="lang-text" data-en="Vacuum Extraction" data-my="·ÄÖ·ÄØ·Äï·Ä∫·Äö·Ä∞·Äô·ÄΩ·Ä±·Ä∏·Äñ·ÄΩ·Ä¨·Ä∏·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏">Vacuum Extraction</option>
                <option value="Forceps Delivery" class="lang-text" data-en="Forceps Delivery" data-my="·Ää·Äæ·Äï·Ä∫·Äñ·Äº·ÄÑ·Ä∑·Ä∫ ·Äô·ÄΩ·Ä±·Ä∏·Äñ·ÄΩ·Ä¨·Ä∏·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏">Forceps Delivery</option>
              </select>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="apgarScore1min" class="lang-text" data-en="APGAR Score (1 min)" data-my="APGAR ·Ä°·Äô·Äæ·Äê·Ä∫ (·ÅÅ ·Äô·Ä≠·Äî·ÄÖ·Ä∫)">APGAR Score (1 min)</label>
              <input type="number" id="apgarScore1min" name="apgarScore1min" class="form-control" min="0" max="10" placeholder="0-10">
            </div>
            <div class="form-group">
              <label for="apgarScore5min" class="lang-text" data-en="APGAR Score (5 min)" data-my="APGAR ·Ä°·Äô·Äæ·Äê·Ä∫ (·ÅÖ ·Äô·Ä≠·Äî·ÄÖ·Ä∫)">APGAR Score (5 min)</label>
              <input type="number" id="apgarScore5min" name="apgarScore5min" class="form-control" min="0" max="10" placeholder="0-10">
            </div>
          </div>
          
          <div class="form-group">
            <label for="birthComplications" class="lang-text" data-en="Birth Complications" data-my="·Äô·ÄΩ·Ä±·Ä∏·Äñ·ÄΩ·Ä¨·Ä∏·Äô·Äæ·ÄØ ·Äî·Ä±·Ä¨·ÄÄ·Ä∫·ÄÜ·ÄÄ·Ä∫·Äê·ÄΩ·Ä≤ ·Äï·Äº·Äø·Äî·Ä¨·Äô·Äª·Ä¨·Ä∏">Birth Complications</label>
            <textarea id="birthComplications" name="birthComplications" class="form-control" rows="3" placeholder="Describe any complications during birth (if none, leave blank)"></textarea>
          </div>
          </div>
        </div>

        <!-- Parent Information Section -->
        <div class="form-section">
          <h3>
            <i class="fas fa-users"></i> <span class="lang-text" data-en="Parent Information" data-my="·Äô·Ä≠·Äò ·Ä°·ÄÅ·Äª·ÄÄ·Ä∫·Ä°·Äú·ÄÄ·Ä∫">Parent Information</span>
            <button class="btn btn-link p-0 ms-2" type="button" data-bs-toggle="collapse" data-bs-target="#parentInfoCollapse" aria-expanded="true" aria-controls="parentInfoCollapse">
              <i class="fas fa-chevron-down collapse-icon"></i>
            </button>
          </h3>
          <div class="collapse show" id="parentInfoCollapse">
          
          <div class="form-row">
            <div class="form-group">
              <label for="motherName" class="lang-text" data-en="Mother's Name" data-my="·Äô·Ä≠·ÄÅ·ÄÑ·Ä∫·Åè ·Ä°·Äô·Ää·Ä∫">Mother's Name</label>
              <input type="text" id="motherName" name="motherName" class="form-control" placeholder="Enter mother's full name">
            </div>
            <div class="form-group">
              <label for="fatherName" class="lang-text" data-en="Father's Name" data-my="·Äñ·ÄÅ·ÄÑ·Ä∫·Åè ·Ä°·Äô·Ää·Ä∫">Father's Name</label>
              <input type="text" id="fatherName" name="fatherName" class="form-control" placeholder="Enter father's full name">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="motherAge" class="lang-text" data-en="Mother's Age" data-my="·Äô·Ä≠·ÄÅ·ÄÑ·Ä∫·Åè ·Ä°·Äû·ÄÄ·Ä∫">Mother's Age</label>
              <input type="number" id="motherAge" name="motherAge" class="form-control" min="12" max="60" placeholder="Enter mother's age">
            </div>
            <div class="form-group">
              <label for="motherPhone" class="lang-text" data-en="Mother's Phone" data-my="·Äô·Ä≠·ÄÅ·ÄÑ·Ä∫·Åè ·Äñ·ÄØ·Äî·Ä∫·Ä∏">Mother's Phone</label>
              <input type="tel" id="motherPhone" name="motherPhone" class="form-control" placeholder="Enter phone number">
            </div>
          </div>
          </div>
        </div>

        <!-- Best Practices Section -->
        <div class="form-section">
          <h3>
            <i class="fas fa-award"></i> <span class="lang-text" data-en="Best Practices Checklist" data-my="·Ä°·ÄÄ·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·ÄÜ·ÄØ·Ä∂·Ä∏ ·Äú·ÄØ·Äï·Ä∫·Äë·ÄØ·Ä∂·Ä∏·Äú·ÄØ·Äï·Ä∫·Äî·Ää·Ä∫·Ä∏·Äô·Äª·Ä¨·Ä∏">Best Practices Checklist</span>
            <button class="btn btn-link p-0 ms-2" type="button" data-bs-toggle="collapse" data-bs-target="#bestPracticesCollapse" aria-expanded="false" aria-controls="bestPracticesCollapse">
              <i class="fas fa-chevron-down collapse-icon"></i>
            </button>
          </h3>
          <div class="collapse" id="bestPracticesCollapse">
          <p class="text-muted mb-4 lang-text" data-en="Essential maternal and newborn care practices" data-my="·Ä°·Äì·Ä≠·ÄÄ ·Äô·Ä≠·ÄÅ·ÄÑ·Ä∫·Äî·Äæ·ÄÑ·Ä∑·Ä∫ ·Äô·ÄΩ·Ä±·Ä∏·ÄÄ·ÄÑ·Ä∫·Ä∏·ÄÖ ·ÄÄ·Äú·Ä±·Ä∏ ·ÄÖ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·Äõ·Äæ·Ä±·Ä¨·ÄÄ·Ä∫·Äô·Äæ·ÄØ ·Äú·ÄØ·Äï·Ä∫·Äë·ÄØ·Ä∂·Ä∏·Äú·ÄØ·Äï·Ä∫·Äî·Ää·Ä∫·Ä∏·Äô·Äª·Ä¨·Ä∏">Essential maternal and newborn care practices</p>
          
          <!-- Maternal Outcome Practices -->
          <div class="best-practices-bundle mb-4">
            <h5 class="section-subtitle lang-text" data-en="Maternal Outcome Practices" data-my="·Äô·Ä≠·ÄÅ·ÄÑ·Ä∫ ·Äõ·Äú·Äí·Ä∫ ·Äú·ÄØ·Äï·Ä∫·Äë·ÄØ·Ä∂·Ä∏·Äú·ÄØ·Äï·Ä∫·Äî·Ää·Ä∫·Ä∏·Äô·Äª·Ä¨·Ä∏">Maternal Outcome Practices</h5>
            <div class="emotive-grid">
              <div class="emotive-item">
                <div class="emotive-checkbox">
                  <input type="checkbox" id="uteronicReceived" name="uteronicReceived" class="custom-checkbox">
                  <label for="uteronicReceived" class="checkbox-label">
                    <span class="checkmark"></span>
                  </label>
                </div>
                <div class="emotive-content">
                  <div class="emotive-letter" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">Ut</div>
                  <div class="emotive-description">
                    <strong>Uterotonic Received</strong>
                    <p>Oxytocin 10 IU IM in third stage of labour/immediately after birth</p>
                  </div>
                </div>
              </div>

              <div class="emotive-item">
                <div class="emotive-checkbox">
                  <input type="checkbox" id="cordTraction" name="cordTraction" class="custom-checkbox">
                  <label for="cordTraction" class="checkbox-label">
                    <span class="checkmark"></span>
                  </label>
                </div>
                <div class="emotive-content">
                  <div class="emotive-letter" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">Ct</div>
                  <div class="emotive-description">
                    <strong>Control Cord Traction</strong>
                    <p>Controlled cord traction performed</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Birth/Newborn Practices -->
          <div class="best-practices-bundle">
            <h5 class="section-subtitle">Birth & Newborn Care Practices</h5>
            <div class="emotive-grid">
              <div class="emotive-item">
                <div class="emotive-checkbox">
                  <input type="checkbox" id="delayedCordClamping" name="delayedCordClamping" class="custom-checkbox">
                  <label for="delayedCordClamping" class="checkbox-label">
                    <span class="checkmark"></span>
                  </label>
                </div>
                <div class="emotive-content">
                  <div class="emotive-letter" style="background: linear-gradient(135deg, #ec4899, #db2777);">Dc</div>
                  <div class="emotive-description">
                    <strong>Delayed Cord Clamping</strong>
                    <p>Practiced delay cord clamping (1-3 min)</p>
                    <div class="duration-input">
                      <input type="text" id="cordClampingDuration" name="cordClampingDuration" class="form-control" placeholder="Duration">
                      <span class="duration-unit">mins</span>
                    </div>
                  </div>
                </div>
              </div>

              <div class="emotive-item">
                <div class="emotive-checkbox">
                  <input type="checkbox" id="skinToSkinContact" name="skinToSkinContact" class="custom-checkbox">
                  <label for="skinToSkinContact" class="checkbox-label">
                    <span class="checkmark"></span>
                  </label>
                </div>
                <div class="emotive-content">
                  <div class="emotive-letter" style="background: linear-gradient(135deg, #ec4899, #db2777);">Sk</div>
                  <div class="emotive-description">
                    <strong>Skin to Skin Contact</strong>
                    <p>Practiced skin to skin contact immediately after birth</p>
                  </div>
                </div>
              </div>

              <div class="emotive-item">
                <div class="emotive-checkbox">
                  <input type="checkbox" id="breastfeedingWithinHour" name="breastfeedingWithinHour" class="custom-checkbox">
                  <label for="breastfeedingWithinHour" class="checkbox-label">
                    <span class="checkmark"></span>
                  </label>
                </div>
                <div class="emotive-content">
                  <div class="emotive-letter" style="background: linear-gradient(135deg, #ec4899, #db2777);">Bf</div>
                  <div class="emotive-description">
                    <strong>Breastfeeding Within One Hour</strong>
                    <p>Breastfeeding initiated within one hour of birth</p>
                  </div>
                </div>
              </div>

              <div class="emotive-item">
                <div class="emotive-checkbox">
                  <input type="checkbox" id="eyeCare" name="eyeCare" class="custom-checkbox">
                  <label for="eyeCare" class="checkbox-label">
                    <span class="checkmark"></span>
                  </label>
                </div>
                <div class="emotive-content">
                  <div class="emotive-letter" style="background: linear-gradient(135deg, #ec4899, #db2777);">Ec</div>
                  <div class="emotive-description">
                    <strong>Eye Care (TEO)</strong>
                    <p>Provision of eye care with Tetracycline Eye Ointment</p>
                  </div>
                </div>
              </div>

              <div class="emotive-item">
                <div class="emotive-checkbox">
                  <input type="checkbox" id="vitaminK" name="vitaminK" class="custom-checkbox">
                  <label for="vitaminK" class="checkbox-label">
                    <span class="checkmark"></span>
                  </label>
                </div>
                <div class="emotive-content">
                  <div class="emotive-letter" style="background: linear-gradient(135deg, #ec4899, #db2777);">Vk</div>
                  <div class="emotive-description">
                    <strong>Vitamin K Injection</strong>
                    <p>Provision of vitamin K (1mg IM) on first day of life</p>
                  </div>
                </div>
              </div>

              <div class="emotive-item">
                <div class="emotive-checkbox">
                  <input type="checkbox" id="hepBVaccine" name="hepBVaccine" class="custom-checkbox">
                  <label for="hepBVaccine" class="checkbox-label">
                    <span class="checkmark"></span>
                  </label>
                </div>
                <div class="emotive-content">
                  <div class="emotive-letter" style="background: linear-gradient(135deg, #ec4899, #db2777);">Hb</div>
                  <div class="emotive-description">
                    <strong>Hep B Vaccine</strong>
                    <p>Provision of Hep B vaccine on first day of life</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button type="submit" class="btn-save-birth">
            <i class="fas fa-save"></i> <span class="lang-text" data-en="Save Birth Record" data-my="·Äô·ÄΩ·Ä±·Ä∏·Äñ·ÄΩ·Ä¨·Ä∏·Äô·Äæ·ÄØ ·Äô·Äæ·Äê·Ä∫·Äê·Äô·Ä∫·Ä∏ ·Äû·Ä≠·Äô·Ä∫·Ä∏·ÄÜ·Ää·Ä∫·Ä∏·Äõ·Äî·Ä∫">Save Birth Record</span>
          </button>
        </div>
      </form>

      <!-- Success Message -->
      <div id="successMessage" class="success-message">
        <i class="fas fa-check-circle"></i>
        <h4>Birth Record Saved Successfully!</h4>
        <p>The baby's information has been recorded. You can now view the complete birth record.</p>
        <button class="btn btn-light mt-3" onclick="viewBirthRecord()">
          <i class="fas fa-eye"></i> View Birth Record
        </button>
      </div>
    </div>
  </div>

  <!-- E-MOTIVE Information Modal -->
  <div class="modal fade" id="emotiveInfoModal" tabindex="-1" aria-labelledby="emotiveInfoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="emotiveInfoModalLabel">
            <i class="fas fa-first-aid me-2"></i>E-MOTIVE Bundle Protocol
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="alert alert-danger">
            <strong>Emergency Protocol:</strong> E-MOTIVE bundle for postpartum hemorrhage management
          </div>
          
          <div class="row">
            <div class="col-md-6">
              <h6><i class="fas fa-hands me-2"></i>M - Massage Uterus</h6>
              <p class="text-muted">Bimanual uterine compression</p>
              
              <h6><i class="fas fa-pills me-2"></i>O - Oxytocic Drugs</h6>
              <p class="text-muted">Administer uterotonic medications</p>
              
              <h6><i class="fas fa-syringe me-2"></i>T - Tranexamic Acid</h6>
              <p class="text-muted">Anti-fibrinolytic therapy</p>
            </div>
            <div class="col-md-6">
              <h6><i class="fas fa-tint me-2"></i>IV - IV Fluids</h6>
              <p class="text-muted">Intravenous fluid resuscitation</p>
              
              <h6><i class="fas fa-stethoscope me-2"></i>E - Examination & Escalation</h6>
              <p class="text-muted">Assess and escalate care if needed</p>
            </div>
          </div>
          
          <div class="alert alert-info mt-3">
            <i class="fas fa-info-circle me-2"></i>
            <strong>Action Required:</strong> If PPH is detected (‚â•500ml blood loss or ‚â•300ml with abnormal uterine tone), start E-MOTIVE bundle immediately and follow protocols.
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Shock Information Modal -->
  <div class="modal fade" id="shockInfoModal" tabindex="-1" aria-labelledby="shockInfoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="shockInfoModalLabel">
            <i class="fas fa-exclamation-triangle me-2"></i>Signs and Symptoms of Impending Shock
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="alert alert-warning">
            <strong>Assessment Criteria:</strong> Monitor the following parameters for signs of impending shock
          </div>
          
          <div class="row">
            <div class="col-md-6">
              <h6><i class="fas fa-heartbeat me-2"></i>Vital Signs</h6>
              <ul class="list-unstyled">
                <li><strong>Systolic BP:</strong> Normal ‚â•90mmHg</li>
                <li><strong>Pulse Rate:</strong> Normal ‚â§100bpm</li>
                <li><strong>Respiratory Rate:</strong> Normal ‚â§22 breaths/min</li>
                <li><strong>Urine Output:</strong> Normal output</li>
              </ul>
            </div>
            <div class="col-md-6">
              <h6><i class="fas fa-user-md me-2"></i>Clinical Signs</h6>
              <ul class="list-unstyled">
                <li>Pale, Cool and Clammy skin</li>
                <li>Sweating</li>
                <li>Anxiety, Restlessness, Confusion or Dizziness</li>
                <li>Nausea, Vomiting and excessive thirst</li>
              </ul>
            </div>
          </div>
          
          <div class="alert alert-info mt-3">
            <i class="fas fa-info-circle me-2"></i>
            <strong>Action Required:</strong> If any abnormal parameters are detected, recheck and if shock is confirmed, start appropriate protocols immediately.
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
      <p class="mb-0">
        <i class="fas fa-heart me-2"></i>
        MNCH App 2025 | Developed by Jhpiego Myanmar for MoH.
      </p>
    </div>
  </footer>

  <script>
    // Language switching
    let currentLanguage = localStorage.getItem('appLanguage') || 'en';

    // Language switching function
    function switchLanguage(lang) {
      currentLanguage = lang;
      localStorage.setItem('appLanguage', lang);
      
      // Update active button
      document.querySelectorAll('.language-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.lang === lang);
      });
      
      // Update all text elements with lang-text class
      document.querySelectorAll('.lang-text').forEach(el => {
        const text = el.dataset[lang] || el.dataset.en || el.textContent;
        // Handle line breaks
        el.innerHTML = text.replace(/&#10;/g, '<br>').replace(/\n/g, '<br>');
      });
      
      // Update save button text if in edit mode
      const saveBtn = document.querySelector('.btn-save-birth');
      if (saveBtn) {
        const urlParams = new URLSearchParams(window.location.search);
        const isEdit = urlParams.get('edit') === 'true';
        if (isEdit) {
          const updateText = lang === 'my' ? '·Äô·ÄΩ·Ä±·Ä∏·Äñ·ÄΩ·Ä¨·Ä∏·Äô·Äæ·ÄØ ·Äô·Äæ·Äê·Ä∫·Äê·Äô·Ä∫·Ä∏ ·Äï·Äº·ÄÑ·Ä∫·ÄÜ·ÄÑ·Ä∫·Äõ·Äî·Ä∫' : 'Update Birth Record';
          saveBtn.innerHTML = `<i class="fas fa-save"></i> ${updateText}`;
        } else {
          // Update the lang-text span in the button
          const langTextSpan = saveBtn.querySelector('.lang-text');
          if (langTextSpan) {
            const text = langTextSpan.dataset[lang] || langTextSpan.dataset.en || langTextSpan.textContent;
            langTextSpan.innerHTML = text.replace(/&#10;/g, '<br>').replace(/\n/g, '<br>');
          }
        }
      }
    }

    // Initialize language switcher on page load
    document.addEventListener('DOMContentLoaded', function() {
      // Set up language switcher button event listeners
      document.querySelectorAll('.language-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          switchLanguage(this.dataset.lang);
        });
      });
      
      // Set initial language
      switchLanguage(currentLanguage);
    });

    // Get patient ID from URL parameters
    function getPatientIdFromUrl() {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get('patient');
    }

    // Check if in edit mode
    function isEditMode() {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get('edit') === 'true';
    }

    // Load patient information
    async function loadPatientInfo() {
      try {
        const patientId = getPatientIdFromUrl();
        if (!patientId) {
          document.body.innerHTML = '<div class="alert alert-danger">Patient ID not found.</div>';
          return;
        }

        // Check if user is authenticated
        const user = firebase.auth().currentUser;
        if (!user) {
          window.location.href = "login.html";
          return;
        }

        // Load patient data
        const patientDoc = await firebase.firestore()
          .collection("patients")
          .doc(patientId)
          .get();

        if (!patientDoc.exists) {
          document.body.innerHTML = '<div class="alert alert-danger">Patient not found.</div>';
          return;
        }

        const patientData = patientDoc.data();
        
        // Populate simplified patient info display
        document.getElementById('patientName').textContent = patientData.name || 'Unknown Patient';

        // Pre-fill mother's name and age
        document.getElementById('motherName').value = patientData.name || '';
        document.getElementById('motherAge').value = patientData.age || '';

        // If in edit mode, load existing birth record
        if (isEditMode()) {
          await loadExistingBirthRecord(patientId);
          const saveBtn = document.querySelector('.btn-save-birth');
          if (saveBtn) {
            const updateText = currentLanguage === 'my' ? '·Äô·ÄΩ·Ä±·Ä∏·Äñ·ÄΩ·Ä¨·Ä∏·Äô·Äæ·ÄØ ·Äô·Äæ·Äê·Ä∫·Äê·Äô·Ä∫·Ä∏ ·Äï·Äº·ÄÑ·Ä∫·ÄÜ·ÄÑ·Ä∫·Äõ·Äî·Ä∫' : 'Update Birth Record';
            saveBtn.innerHTML = `<i class="fas fa-save"></i> ${updateText}`;
          }
        } else {
          // Set default birth time to current time for new records
          const now = new Date();
          const localDateTime = new Date(now.getTime() - now.getTimezoneOffset() * 60000);
          document.getElementById('birthTime').value = localDateTime.toISOString().slice(0, 16);
          
          // Auto-generate baby name as "Baby [Patient name]"
          const babyNameField = document.getElementById('babyName');
          if (babyNameField && !babyNameField.value) {
            const patientName = patientData.name || 'Unknown';
            babyNameField.value = `Baby ${patientName}`;
          }
        }

      } catch (error) {
        console.error('Error loading patient info:', error);
        document.body.innerHTML = `<div class="alert alert-danger">Error loading patient information: ${error.message}</div>`;
      }
    }

    // Load existing birth record for editing
    async function loadExistingBirthRecord(patientId) {
      try {
        const birthRecordDoc = await firebase.firestore()
          .collection('patients')
          .doc(patientId)
          .collection('records')
          .doc('birthRecord')
          .get();

        if (birthRecordDoc.exists) {
          const data = birthRecordDoc.data();
          
          // Populate all form fields with existing data
          document.getElementById('babyName').value = data.babyName || '';
          document.getElementById('babyGender').value = data.babyGender || '';
          document.getElementById('birthTime').value = data.birthTime || '';
          document.getElementById('birthWeight').value = data.birthWeight || '';
          document.getElementById('birthLength').value = data.birthLength || '';
          document.getElementById('headCircumference').value = data.headCircumference || '';
          document.getElementById('birthPlace').value = data.birthPlace || '';
          document.getElementById('deliveryMethod').value = data.deliveryMethod || '';
          document.getElementById('apgarScore1min').value = data.apgarScore1min || '';
          document.getElementById('apgarScore5min').value = data.apgarScore5min || '';
          document.getElementById('birthComplications').value = data.birthComplications || '';
          document.getElementById('motherName').value = data.motherName || '';
          document.getElementById('fatherName').value = data.fatherName || '';
          document.getElementById('motherAge').value = data.motherAge || '';
          document.getElementById('motherPhone').value = data.motherPhone || '';
          
          // Vital signs data removed - now handled in PNC
          
          
          // Load Best Practices data
          document.getElementById('uteronicReceived').checked = data.uteronicReceived || false;
          document.getElementById('cordTraction').checked = data.cordTraction || false;
          document.getElementById('delayedCordClamping').checked = data.delayedCordClamping || false;
          document.getElementById('cordClampingDuration').value = data.cordClampingDuration || '';
          document.getElementById('skinToSkinContact').checked = data.skinToSkinContact || false;
          document.getElementById('breastfeedingWithinHour').checked = data.breastfeedingWithinHour || false;
          document.getElementById('eyeCare').checked = data.eyeCare || false;
          document.getElementById('vitaminK').checked = data.vitaminK || false;
          document.getElementById('hepBVaccine').checked = data.hepBVaccine || false;
          
          console.log('Existing birth record loaded for editing');
        } else {
          console.log('No existing birth record found');
        }
      } catch (error) {
        console.error('Error loading existing birth record:', error);
      }
    }

    // Save birth record
    async function saveBirthRecord(event) {
      event.preventDefault();
      
      try {
        const patientId = getPatientIdFromUrl();
        if (!patientId) {
          alert('Patient ID not found.');
          return;
        }

        // Collect form data
        const formData = {
          babyName: document.getElementById('babyName').value || '',
          babyGender: document.getElementById('babyGender').value || '',
          birthTime: document.getElementById('birthTime').value || '',
          birthWeight: parseFloat(document.getElementById('birthWeight').value) || null, // Changed to pounds
          birthLength: parseFloat(document.getElementById('birthLength').value) || null,
          headCircumference: parseFloat(document.getElementById('headCircumference').value) || null,
          birthPlace: document.getElementById('birthPlace').value || '',
          deliveryMethod: document.getElementById('deliveryMethod').value || '',
          apgarScore1min: parseInt(document.getElementById('apgarScore1min').value) || null,
          apgarScore5min: parseInt(document.getElementById('apgarScore5min').value) || null,
          birthComplications: document.getElementById('birthComplications').value || '',
          motherName: document.getElementById('motherName').value || '',
          fatherName: document.getElementById('fatherName').value || '',
          motherAge: parseInt(document.getElementById('motherAge').value) || null,
          motherPhone: document.getElementById('motherPhone').value || '',
          
          // Complications & E-MOTIVE data
          // Vital signs removed - now handled in PNC
          vitalSigns: [],
          
          
          // Best Practices - Maternal Outcome
          uteronicReceived: document.getElementById('uteronicReceived').checked,
          cordTraction: document.getElementById('cordTraction').checked,
          
          // Best Practices - Birth & Newborn Care
          delayedCordClamping: document.getElementById('delayedCordClamping').checked,
          cordClampingDuration: document.getElementById('cordClampingDuration').value || '',
          skinToSkinContact: document.getElementById('skinToSkinContact').checked,
          breastfeedingWithinHour: document.getElementById('breastfeedingWithinHour').checked,
          eyeCare: document.getElementById('eyeCare').checked,
          vitaminK: document.getElementById('vitaminK').checked,
          hepBVaccine: document.getElementById('hepBVaccine').checked,
          
          patientId: patientId,
          recordedBy: firebase.auth().currentUser?.uid || 'unknown',
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        };

        // Save birth record to Firestore
        await firebase.firestore()
          .collection('patients')
          .doc(patientId)
          .collection('records')
          .doc('birthRecord')
          .set(formData);

        // Save endTreatment document with outcome 'birth'
        await firebase.firestore()
          .collection('patients')
          .doc(patientId)
          .collection('records')
          .doc('endTreatment')
          .set({
            outcome: 'birth',
            recordedBy: firebase.auth().currentUser?.uid || 'unknown',
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
          });

        // Update patient status to "Birthed (Postnatal)" in main patients collection
        await firebase.firestore()
          .collection('patients')
          .doc(patientId)
          .update({
            status: 'Birthed (Postnatal)',
            birthRecordId: firebase.firestore().collection('patients').doc(patientId).collection('records').doc('birthRecord').id,
            last_updated: firebase.firestore.FieldValue.serverTimestamp()
          });

        // Show success message and redirect
        if (isEditMode()) {
          alert('Birth record updated successfully! Redirecting to baby care...');
          window.location.href = 'baby-care.html';
        } else {
          alert('Birth record saved successfully! Redirecting to dashboard...');
          window.location.href = 'index.html';
        }
        
        console.log('Birth record saved successfully and patient status updated');

      } catch (error) {
        console.error('Error saving birth record:', error);
        alert(`Error saving birth record: ${error.message}`);
      }
    }


    // View birth record
    function viewBirthRecord() {
      const patientId = getPatientIdFromUrl();
      if (patientId) {
        // You can create a birth-record-view.html page or redirect to summary
        window.location.href = `summary.html?patient=${patientId}`;
      }
    }

    // Auto-detect postpartum hemorrhage based on blood loss and uterine tone
    function checkBloodLoss() {
      const bloodLoss = parseInt(document.getElementById('totalBloodLoss').value);
      const uterineTone = document.getElementById('uterineTone').value;
      const manualPPH = document.getElementById('manualPPH').checked;
      const hemorrhageAlert = document.getElementById('hemorrhageAlert');
      const pphAlertTitle = document.getElementById('pphAlertTitle');
      const pphAlertMessage = document.getElementById('pphAlertMessage');
      
      // Manual PPH override
      if (manualPPH) {
        hemorrhageAlert.style.display = 'block';
        pphAlertTitle.textContent = 'Postpartum Hemorrhage (PPH) detected!';
        pphAlertMessage.textContent = 'Start EMOTIVE bundle and follow protocols';
        return;
      }
      
      // Automatic PPH detection
      if (bloodLoss && bloodLoss >= 500) {
        // Blood loss 500ml or more = PPH
        hemorrhageAlert.style.display = 'block';
        pphAlertTitle.textContent = 'Postpartum Hemorrhage (PPH) detected!';
        pphAlertMessage.textContent = 'Start EMOTIVE bundle and follow protocols';
        
        // Show alert to user only once
        if (!hemorrhageAlert.getAttribute('data-alerted')) {
          alert('‚ö†Ô∏è Postpartum hemorrhage detected (‚â•500ml). Start EMOTIVE bundle and follow protocols.');
          hemorrhageAlert.setAttribute('data-alerted', 'true');
        }
      } else if (bloodLoss && bloodLoss >= 300 && uterineTone === 'not-contracted') {
        // Blood loss 300ml or more + abnormal uterine tone = PPH
        hemorrhageAlert.style.display = 'block';
        pphAlertTitle.textContent = 'Postpartum Hemorrhage (PPH) detected!';
        pphAlertMessage.textContent = 'Check abnormal parameters (e.g SHOCK) and if found, Start EMOTIVE bundle and follow protocols';
        
        // Show alert to user only once
        if (!hemorrhageAlert.getAttribute('data-alerted')) {
          alert('‚ö†Ô∏è Postpartum hemorrhage detected (‚â•300ml + abnormal uterine tone). Check for shock and start EMOTIVE bundle if confirmed.');
          hemorrhageAlert.setAttribute('data-alerted', 'true');
        }
      } else {
        hemorrhageAlert.style.display = 'none';
        hemorrhageAlert.removeAttribute('data-alerted');
      }
    }


    // Add new vital signs set
    let vitalSignsCounter = 1;
    
    function addVitalSignsSet() {
      vitalSignsCounter++;
      const container = document.getElementById('vitalSignsContainer');
      
      const newVitalSet = document.createElement('div');
      newVitalSet.className = 'vital-signs-set';
      newVitalSet.setAttribute('data-set', vitalSignsCounter);
      
      newVitalSet.innerHTML = `
        <div class="vital-signs-header">
          <h6 class="vital-set-title">
            <i class="fas fa-heartbeat me-2"></i>Vital Signs Reading #${vitalSignsCounter}
          </h6>
          <button type="button" class="remove-vital-set" onclick="removeVitalSignsSet(${vitalSignsCounter})">
            <i class="fas fa-times me-1"></i>Remove
          </button>
        </div>
        
        <!-- Common Time Input -->
        <div class="mb-3">
          <label class="form-label">Recording Time:</label>
          <input type="time" id="vitalTime_${vitalSignsCounter}" name="vitalTime_${vitalSignsCounter}" class="form-control time-input" style="width: 200px;">
        </div>
        
        <div class="vital-signs-grid">
          <div class="vital-sign-item">
            <label>Temperature (¬∞C)</label>
            <input type="number" id="temperature_${vitalSignsCounter}" name="temperature_${vitalSignsCounter}" class="form-control" placeholder="37.5" step="0.1">
          </div>
          
          <div class="vital-sign-item">
            <label>Blood Pressure (mmHg)</label>
            <input type="text" id="bloodPressure_${vitalSignsCounter}" name="bloodPressure_${vitalSignsCounter}" class="form-control" placeholder="120/80">
          </div>
          
          <div class="vital-sign-item">
            <label>Pulse Rate (bpm)</label>
            <input type="number" id="pulseRate_${vitalSignsCounter}" name="pulseRate_${vitalSignsCounter}" class="form-control" placeholder="80" min="40" max="200">
          </div>
          
          <div class="vital-sign-item">
            <label>Respiratory Rate (breaths/min)</label>
            <input type="number" id="respiratoryRate_${vitalSignsCounter}" name="respiratoryRate_${vitalSignsCounter}" class="form-control" placeholder="20" min="10" max="40">
          </div>
        </div>
      `;
      
      container.appendChild(newVitalSet);
      
      // Auto-set current time for new reading
      const now = new Date();
      const currentTime = now.toTimeString().slice(0, 5);
      document.getElementById(`vitalTime_${vitalSignsCounter}`).value = currentTime;
    }

    function removeVitalSignsSet(setNumber) {
      if (setNumber === 1) {
        alert('Cannot remove the first vital signs reading.');
        return;
      }
      
      const setElement = document.querySelector(`[data-set="${setNumber}"]`);
      if (setElement) {
        setElement.remove();
      }
    }

    function collectAllVitalSigns() {
      const vitalSigns = [];
      const vitalSets = document.querySelectorAll('.vital-signs-set');
      
      vitalSets.forEach(set => {
        const setNumber = set.getAttribute('data-set');
        const vitalData = {
          setNumber: parseInt(setNumber),
          recordingTime: document.getElementById(`vitalTime_${setNumber}`).value || '',
          temperature: parseFloat(document.getElementById(`temperature_${setNumber}`).value) || null,
          bloodPressure: document.getElementById(`bloodPressure_${setNumber}`).value || '',
          pulseRate: parseInt(document.getElementById(`pulseRate_${setNumber}`).value) || null,
          respiratoryRate: parseInt(document.getElementById(`respiratoryRate_${setNumber}`).value) || null
        };
        
        // Only add if at least one vital sign is recorded
        if (vitalData.temperature || vitalData.bloodPressure || vitalData.pulseRate || vitalData.respiratoryRate) {
          vitalSigns.push(vitalData);
        }
      });
      
      return vitalSigns;
    }

    function loadMultipleVitalSigns(vitalSignsData) {
      // Clear existing vital signs except the first one
      const container = document.getElementById('vitalSignsContainer');
      const existingSets = container.querySelectorAll('.vital-signs-set');
      existingSets.forEach((set, index) => {
        if (index > 0) {
          set.remove();
        }
      });
      
      // Reset counter
      vitalSignsCounter = 1;
      
      // Load each vital signs set
      vitalSignsData.forEach((vital, index) => {
        if (index === 0) {
          // Load into first set
          document.getElementById('vitalTime_1').value = vital.recordingTime || vital.temperatureTime || '';
          document.getElementById('temperature_1').value = vital.temperature || '';
          document.getElementById('bloodPressure_1').value = vital.bloodPressure || '';
          document.getElementById('pulseRate_1').value = vital.pulseRate || '';
          document.getElementById('respiratoryRate_1').value = vital.respiratoryRate || '';
        } else {
          // Add new set and populate
          addVitalSignsSet();
          const setNumber = vitalSignsCounter;
          document.getElementById(`vitalTime_${setNumber}`).value = vital.recordingTime || vital.temperatureTime || '';
          document.getElementById(`temperature_${setNumber}`).value = vital.temperature || '';
          document.getElementById(`bloodPressure_${setNumber}`).value = vital.bloodPressure || '';
          document.getElementById(`pulseRate_${setNumber}`).value = vital.pulseRate || '';
          document.getElementById(`respiratoryRate_${setNumber}`).value = vital.respiratoryRate || '';
        }
      });
    }

    // Load data when page loads
    firebase.auth().onAuthStateChanged(function(user) {
      if (!user) {
        window.location.href = "login.html";
      } else {
        loadPatientInfo();
        
        // Add event listener for blood loss monitoring
        document.getElementById('totalBloodLoss').addEventListener('input', checkBloodLoss);
      }
    });
  </script>
</body>
</html>
