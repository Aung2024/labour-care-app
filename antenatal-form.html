<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ANC Visit Record - Maternal & Child Health Care System</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="css/style.css" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="js/firebase.js"></script>
  <script src="js/status-manager.js"></script>
  <style>
    :root {
      --primary-color: #10b981;
      --secondary-color: #059669;
      --accent-color: #34d399;
      --light-bg: #f0fdf4;
      --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    body {
      background: var(--light-bg);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .header-section {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      padding: 1.5rem 0;
      margin-bottom: 2rem;
    }

    .form-section {
      background: white;
      border-radius: 15px;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: var(--card-shadow);
      border-left: 4px solid var(--primary-color);
    }

    .section-title {
      color: var(--primary-color);
      font-weight: 600;
      margin-bottom: 1.5rem;
      border-bottom: 2px solid #e5e7eb;
      padding-bottom: 0.5rem;
    }

    .card-subtitle {
      font-size: 0.85rem;
      font-weight: 600;
      color: #2563eb;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin: 1.25rem 0 0.75rem;
    }

    .form-hint {
      font-size: 0.8rem;
      color: #6b7280;
    }

    .patient-name-header {
      background: linear-gradient(135deg, #3b82f6, #1d4ed8);
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 10px;
      margin-bottom: 1.5rem;
      text-align: center;
    }

    .patient-name-header h4 {
      margin: 0;
      font-weight: 600;
    }

    .anc-table {
      border: 2px solid #e5e7eb;
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 2rem;
    }

    .anc-table th {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      font-weight: 600;
      text-align: center;
      padding: 0.75rem 0.5rem;
      border: none;
      font-size: 0.9rem;
    }

    .anc-table td {
      padding: 0.75rem 0.5rem;
      border: 1px solid #e5e7eb;
      vertical-align: middle;
    }

    .anc-table input,
    .anc-table select {
      border: none;
      background: transparent;
      width: 100%;
      padding: 0.25rem;
      font-size: 0.9rem;
    }

    .anc-table input:focus,
    .anc-table select:focus {
      outline: 2px solid var(--primary-color);
      background: #f0fdf4;
      border-radius: 4px;
    }

    .danger-signs-card {
      border: 2px solid #f59e0b;
      border-radius: 10px;
      margin-bottom: 1rem;
    }

    .danger-signs-card .card-header {
      background: linear-gradient(135deg, #f59e0b, #d97706);
      color: white;
      font-weight: 600;
    }

    .danger-signs-card.severe {
      border-color: #dc2626;
    }

    .danger-signs-card.severe .card-header {
      background: linear-gradient(135deg, #dc2626, #b91c1c);
    }

    .form-check-input:checked {
      background-color: var(--primary-color);
      border-color: var(--primary-color);
    }

    .quick-fill-btn {
      background: var(--accent-color);
      color: white;
      border: none;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.75rem;
      margin-top: 0.25rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .quick-fill-btn:hover {
      background: var(--secondary-color);
      transform: translateY(-1px);
    }

    .btn-save {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      border: none;
      color: white;
      padding: 0.75rem 2rem;
      border-radius: 8px;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .btn-save:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
    }

    .footer {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      color: #374151;
      text-align: center;
      padding: 2rem;
      margin-top: 2rem;
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: var(--card-shadow);
    }

    /* Mobile-First ANC Form Styles */
    .mobile-anc-form {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 1.5rem;
      margin-bottom: 2rem;
    }

    .form-row-mobile {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .form-group-mobile {
      background: white;
      padding: 1rem;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
      transition: all 0.3s ease;
    }

    .form-group-mobile:hover {
      border-color: var(--primary-color);
      box-shadow: 0 2px 8px rgba(16, 185, 129, 0.1);
    }

    .form-group-mobile .form-label {
      font-weight: 600;
      color: #374151;
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
    }

    .form-group-mobile .form-control {
      border: 1px solid #d1d5db;
      border-radius: 6px;
      padding: 0.75rem;
      font-size: 0.95rem;
      transition: all 0.3s ease;
    }

    .form-group-mobile .form-control:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
      outline: none;
    }

    @media (max-width: 768px) {
      .form-row-mobile {
        grid-template-columns: 1fr;
        gap: 0.75rem;
      }
      
      .form-group-mobile {
        padding: 0.75rem;
      }
      
      .mobile-anc-form {
        padding: 1rem;
      }
      
      .patient-name-header {
        padding: 0.75rem 1rem;
      }
      
      .patient-name-header h4 {
        font-size: 1.1rem;
      }
    }

    @media (max-width: 480px) {
      .form-group-mobile .form-control {
        padding: 0.5rem;
        font-size: 0.9rem;
      }
      
      .form-group-mobile .form-label {
        font-size: 0.85rem;
      }
    }

    /* Language Switcher */
    .language-switcher {
      display: flex;
      gap: 0.25rem;
      align-items: center;
    }

    .language-btn {
      padding: 0.375rem 0.75rem;
      font-size: 0.875rem;
      border-radius: 8px;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 0.25rem;
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
    }

    .language-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      border-color: rgba(255, 255, 255, 0.5);
    }

    .language-btn.active {
      background: rgba(255, 255, 255, 0.4);
      border-color: rgba(255, 255, 255, 0.6);
      font-weight: 600;
    }

    .flag-icon {
      font-size: 1rem;
    }

    @media (max-width: 768px) {
      .header-section .d-flex {
        flex-wrap: wrap;
        gap: 0.5rem !important;
        justify-content: flex-start !important;
      }

      .header-section .btn-sm {
        padding: 0.375rem 0.75rem;
        font-size: 0.8rem;
        white-space: nowrap;
      }

      .language-switcher {
        order: 1;
      }

      .header-section .btn-outline-light {
        order: 2;
        flex: 0 0 auto;
      }
    }

    @media (max-width: 576px) {
      .header-section {
        padding: 0.75rem 0;
      }

      .header-section h1 {
        font-size: 1.25rem;
        margin-bottom: 0.5rem;
      }

      .header-section .col-md-4 {
        margin-top: 0.5rem;
      }

      .header-section .d-flex {
        gap: 0.375rem !important;
      }

      .header-section .btn-sm {
        padding: 0.3rem 0.6rem;
        font-size: 0.75rem;
      }

      .language-btn {
        padding: 0.3rem 0.5rem !important;
        font-size: 0.7rem !important;
      }

      .flag-icon {
        font-size: 0.875rem;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header-section">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-8">
          <h1 class="mb-2">
            <i class="fas fa-clipboard-list me-3"></i>
            <span class="lang-text" data-en="ANC Visit Record" data-mm="á€€á€­á€¯á€šá€ºá€á€”á€ºá€†á€±á€¬á€„á€º á€•á€¼á€¯á€…á€¯á€…á€±á€¬á€„á€·á€ºá€›á€¾á€±á€¬á€€á€ºá€™á€¾á€¯">ANC Visit Record</span>
          </h1>
        </div>
        <div class="col-md-4 text-end">
          <div class="d-flex align-items-center justify-content-end gap-3">
            <!-- Language Switcher -->
            <div class="language-switcher">
              <button type="button" class="btn btn-sm language-btn" data-lang="en" title="English">
                <span class="flag-icon">ðŸ‡¬ðŸ‡§</span> ENG
              </button>
              <button type="button" class="btn btn-sm language-btn active" data-lang="mm" title="á€™á€¼á€”á€ºá€™á€¬">
                <span class="flag-icon">ðŸ‡²ðŸ‡²</span> MM
              </button>
            </div>
            <a href="antenatal-care.html" class="btn btn-outline-light btn-sm">
              <i class="fas fa-arrow-left me-2"></i><span class="lang-text" data-en="Back to ANC" data-mm="á€€á€­á€¯á€šá€ºá€á€”á€ºá€†á€±á€¬á€„á€º á€•á€¼á€¯á€…á€¯á€…á€±á€¬á€„á€·á€ºá€›á€¾á€±á€¬á€€á€ºá€™á€¾á€¯ á€žá€­á€¯á€· á€•á€¼á€”á€ºá€žá€½á€¬á€¸á€›á€”á€º">Back to ANC</span>
            </a>
            <button class="btn btn-outline-light btn-sm" onclick="firebase.auth().signOut(); localStorage.clear(); window.location='login.html';">
              <i class="fas fa-sign-out-alt me-2"></i><span class="lang-text" data-en="Logout" data-mm="á€‘á€½á€€á€ºá€›á€”á€º">Logout</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- Patient Name Header -->
    <div class="patient-name-header">
      <h4 class="mb-0">
        <i class="fas fa-user me-2"></i>
        <span id="patientNameDisplay">Loading...</span>
      </h4>
    </div>

    <!-- ANC Visit Form -->
    <form id="ancForm" onsubmit="saveVisitData(event)">
      <!-- ANC Information -->
      <div class="form-section">
        <h5 class="section-title">
          <i class="fas fa-info-circle me-2"></i><span class="lang-text" data-en="ANC Information" data-mm="á€€á€­á€¯á€šá€ºá€á€”á€ºá€†á€±á€¬á€„á€ºá€•á€¼á€¯á€…á€¯á€…á€±á€¬á€„á€·á€ºá€›á€¾á€±á€¬á€€á€ºá€™á€¾á€¯á€”á€¾á€„á€·á€º á€žá€€á€ºá€†á€­á€¯á€„á€ºá€žá€±á€¬ á€žá€á€„á€ºá€¸á€¡á€á€»á€€á€ºá€¡á€œá€€á€ºá€™á€»á€¬á€¸">ANC Information</span>
        </h5>
      </div>

      <!-- Visit Information -->
      <div class="form-section">
        <h5 class="section-title">
          <i class="fas fa-calendar-alt me-2"></i><span class="lang-text" data-en="Visit Information" data-mm="á€•á€¼á€žá€™á€¾á€¯ á€¡á€á€»á€€á€ºá€¡á€œá€€á€º">Visit Information</span>
        </h5>
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label lang-text" data-en="Visit Number&#10;This Facility - (Auto generate)&#10;Other Facility - Text Box" data-mm="á€¡á€€á€¼á€­á€™á€ºá€¡á€›á€±á€¡á€á€½á€€á€º">Visit Number<br>This Facility - (Auto generate)<br>Other Facility - Text Box</label>
            <div class="d-flex gap-2">
              <input type="number" class="form-control" id="visitNumber" name="visitNumber" readonly style="flex: 1;" placeholder="">
              <input type="text" class="form-control" id="visitNumberOther" name="visitNumberOther" placeholder="Other Facility" style="flex: 1;">
            </div>
            <small class="form-hint lang-text" data-en="" data-mm=""></small>
          </div>
          <div class="col-md-6">
            <label class="form-label lang-text" data-en="Date of Visit (mm/dd/yyyy)" data-mm="á€œá€¬á€›á€±á€¬á€€á€ºá€•á€¼á€žá€žá€Šá€·á€º á€›á€€á€ºá€…á€½á€² (á€œ/á€›á€€á€ºá€…á€½á€²/á€á€¯á€”á€¾á€…á€º)">Date of Visit (mm/dd/yyyy)</label>
            <div class="d-flex gap-2">
              <input type="date" class="form-control" id="visitDate" name="visitDate" required>
              <button type="button" class="quick-fill-btn" onclick="setToday('visitDate')">Today</button>
          </div>
        </div>
          <div class="col-md-6">
            <label class="form-label lang-text" data-en="Other Visits (e.g. private/other facility)" data-mm="á€¡á€á€¼á€¬á€¸ á€…á€±á€¬á€„á€·á€ºá€›á€¾á€±á€¬á€€á€ºá€™á€¾á€¯ (á€¥á€•á€™á€¬ - á€•á€¯á€‚á€¹á€‚á€œá€­á€€/á€¡á€á€¼á€¬á€¸ á€€á€»á€”á€ºá€¸á€™á€¬á€›á€±á€¸á€Œá€¬á€”)">Other Visits (e.g. private/other facility)</label>
            <input type="number" class="form-control" id="otherVisitCount" name="otherVisitCount" min="0" step="1" value="0">
            <small class="form-hint lang-text" data-en="Optional: include additional visits outside this record" data-mm="">Optional: include additional visits outside this record</small>
          </div>
        </div>
      </div>

      <!-- History Taking -->
      <div class="form-section">
        <h5 class="section-title">
          <i class="fas fa-clipboard-list me-2"></i><span class="lang-text" data-en="History Taking" data-mm="á€›á€¬á€‡á€á€„á€º á€™á€±á€¸á€™á€¼á€”á€ºá€¸á€á€¼á€„á€ºá€¸">History Taking</span>
        </h5>

        <div class="row g-3 align-items-end">
          <div class="col-lg-4 col-md-6">
            <label class="form-label d-block lang-text" data-en="LMP Status" data-mm="á€”á€±á€¬á€€á€ºá€†á€¯á€¶á€¸á€›á€¬á€žá€®á€•á€±á€«á€ºá€žá€Šá€·á€º á€›á€€á€º">LMP Status</label>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="lmpStatus" id="lmpKnown" value="known" checked onchange="toggleLMPFields()">
              <label class="form-check-label lang-text" data-en="LMP Known" data-mm="á€”á€±á€¬á€€á€ºá€†á€¯á€¶á€¸á€›á€¬á€žá€®á€•á€±á€«á€ºá€žá€Šá€·á€º á€›á€€á€ºá€€á€­á€¯á€žá€­á€•á€«á€žá€Šá€º">LMP Known</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="lmpStatus" id="lmpUnknown" value="unknown" onchange="toggleLMPFields()">
              <label class="form-check-label lang-text" data-en="LMP Unknown (Ultrasound-based)" data-mm="á€”á€±á€¬á€€á€ºá€†á€¯á€¶á€¸á€›á€¬á€žá€®á€•á€±á€«á€ºá€žá€Šá€·á€º á€›á€€á€ºá€€á€­á€¯ á€™á€žá€­á€•á€«">LMP Unknown (Ultrasound-based)</label>
            </div>
          </div>
          <div class="col-lg-4 col-md-6 history-known-only" id="lmpKnownGroup">
            <label for="lmp" class="form-label lang-text" data-en="Last Menstrual Period (LMP)_mm/dd/yyyy" data-mm="á€”á€±á€¬á€€á€ºá€†á€¯á€¶á€¸á€›á€¬á€žá€®á€•á€±á€«á€ºá€žá€Šá€·á€º á€›á€€á€ºá€…á€½á€²">Last Menstrual Period (LMP)_mm/dd/yyyy</label>
            <input type="date" id="lmp" name="lmp" class="form-control" onchange="calculateGestationalAgeAndEDD()">
            </div>
          <div class="col-lg-4 col-md-6 history-known-only" id="eddKnownGroup">
            <label for="edd" class="form-label lang-text" data-en="Expected Due Date (EDD)_mm/dd/yyyy" data-mm="á€á€”á€·á€ºá€™á€¾á€”á€ºá€¸á€™á€½á€±á€¸á€–á€½á€¬á€¸á€›á€€á€º (EDD)_á€œ/á€›á€€á€ºá€…á€½á€²/á€á€¯á€”á€¾á€…á€º">Expected Due Date (EDD)_mm/dd/yyyy</label>
            <input type="date" id="edd" name="edd" class="form-control" readonly>
            <small class="form-hint lang-text" data-en="Auto-calculated when LMP is known" data-mm="">Auto-calculated when LMP is known</small>
          </div>
        </div>
        
        <div id="manualGAEDDSection" class="row g-3 mt-1" style="display: none;">
          <div class="col-md-6">
            <label for="manualGestationalAge" class="form-label lang-text" data-en="Manual Gestational Age (if LMP unknown)" data-mm="á€€á€­á€¯á€šá€ºá€á€”á€ºá€†á€±á€¬á€„á€ºá€€á€¬á€œ ">Manual Gestational Age (if LMP unknown)</label>
            <input type="number" id="manualGestationalAge" name="manualGestationalAge" class="form-control" step="0.1" min="0" max="42" onchange="calculateEDDFromGA()">
          </div>
          <div class="col-md-6">
            <label for="manualEdd" class="form-label lang-text" data-en="Expected Due Date (EDD)_mm/dd/yyyy" data-mm="á€á€”á€·á€ºá€™á€¾á€”á€ºá€¸á€™á€½á€±á€¸á€–á€½á€¬á€¸á€›á€€á€º (EDD)_á€œ/á€›á€€á€ºá€…á€½á€²/á€á€¯á€”á€¾á€…á€º">Expected Due Date (EDD)_mm/dd/yyyy</label>
            <input type="date" id="manualEdd" name="manualEdd" class="form-control">
          </div>
        </div>
        
        <div id="autoGASection" class="row g-3 mt-0">
          <div class="col-md-6" id="autoGAGrid">
            <label for="gestationalAgeDisplay" class="form-label lang-text" data-en="Gestational Age (Weeks)" data-mm="á€€á€­á€¯á€šá€ºá€á€”á€ºá€†á€±á€¬á€„á€ºá€€á€¬á€œ (á€›á€€á€ºá€žá€á€¹á€á€•á€á€º)">Gestational Age (Weeks)</label>
            <input type="number" id="gestationalAgeDisplay" name="gestationalAgeDisplay" class="form-control" step="0.1" min="0" max="42" readonly>
            <small class="form-hint lang-text" data-en="Auto-calculated from LMP or manual entry" data-mm="">Auto-calculated from LMP or manual entry</small>
          </div>
        </div>
        
        <div class="mt-4">
            <label class="form-label">
            <i class="fas fa-calendar-plus"></i><span class="lang-text" data-en="Early ANC Visit" data-mm="á€€á€­á€¯á€šá€ºá€á€”á€ºá€†á€±á€¬á€„á€º á€•á€¼á€¯á€…á€¯á€…á€±á€¬á€„á€·á€ºá€›á€¾á€±á€¬á€€á€ºá€™á€¾á€¯ á€¡á€…á€±á€¬á€•á€­á€¯á€„á€ºá€¸">Early ANC Visit</span>
            </label>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" name="earlyAncVisit" id="earlyAncVisit" value="yes">
            <label class="form-check-label" for="earlyAncVisit"><span class="lang-text" data-en="Patient attended ANC before 14 weeks" data-mm="á€œá€°á€”á€¬á€žá€Šá€º áá„ á€•á€á€ºá€™á€á€­á€¯á€„á€ºá€™á€® á€€á€­á€¯á€šá€ºá€á€”á€ºá€†á€±á€¬á€„á€º á€•á€¼á€¯á€…á€¯á€…á€±á€¬á€„á€·á€ºá€›á€¾á€±á€¬á€€á€ºá€™á€¾á€¯ á€á€¶á€šá€°á€á€²á€·á€žá€Šá€º">Patient attended ANC before 14 weeks</span></label>
          </div>
        </div>
        
        <div class="card-subtitle"><i class="fas fa-history me-2"></i><span class="lang-text" data-en="Past History (Family/Medical/Surgery/OG/Drugs/Social)" data-mm="á€šá€á€„á€º á€›á€¬á€‡á€á€„á€ºá€™á€»á€¬á€¸ (Family/Medical/Surgery/OG/Drugs/Social)">Past History (Family/Medical/Surgery/OG/Drugs/Social)</span></div>
        <div class="row g-3">
          <div class="col-lg-4 col-md-6">
            <label class="form-label d-block lang-text" data-en="Status" data-mm="á€¡á€á€¼á€±á€¡á€”á€±">Status</label>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="pastHistoryStatus" id="pastHistoryStatusNAD" value="nad" checked onchange="togglePastHistoryNotes()">
              <label class="form-check-label" for="pastHistoryStatusNAD">NAD</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="pastHistoryStatus" id="pastHistoryStatusRisk" value="risk" onchange="togglePastHistoryNotes()">
              <label class="form-check-label" for="pastHistoryStatusRisk">Risk +</label>
            </div>
          </div>
          <div class="col-lg-8 col-md-6" id="pastHistoryNotesGroup" style="display: none;">
            <label class="form-label lang-text" data-en="If select \"Risk+\", Open \"Text Box\"" data-mm="\"Risk+\" á€€á€­á€¯ á€›á€½á€±á€¸á€á€»á€šá€ºá€•á€«á€€ \"Text Box\" á€€á€­á€¯ á€–á€½á€„á€·á€ºá€›á€”á€º">If select \"Risk+\", Open \"Text Box\"</label>
            <textarea class="form-control" id="pastHistoryNotes" name="pastHistoryNotes" rows="2" placeholder="Family / Medical / Surgical / OG / Drugs / Social history"></textarea>
            <small class="form-hint lang-text" data-en="Note type when Risk+ is selected" data-mm="\"Risk+\" á€€á€­á€¯ á€›á€½á€±á€¸á€á€»á€šá€ºá€•á€«á€€ á€¡á€™á€»á€­á€¯á€¸á€¡á€…á€¬á€¸á€€á€­á€¯ á€™á€¾á€á€ºá€žá€¬á€¸á€›á€”á€º">Note type when Risk+ is selected</small>
            </div>
          </div>
        </div>
        
      <!-- Physical Examination -->
      <div class="form-section">
        <h5 class="section-title">
          <i class="fas fa-stethoscope me-2"></i><span class="lang-text" data-en="General Examination (Look, Listen, Feel)" data-mm="á€¡á€‘á€½á€±á€‘á€½á€± á€…á€™á€ºá€¸á€žá€•á€ºá€…á€…á€ºá€†á€±á€¸á€á€¼á€„á€ºá€¸">General Examination (Look, Listen, Feel)</span>
        </h5>

        <div class="card-subtitle"><i class="fas fa-female me-2"></i><span class="lang-text" data-en="Maternal Portion" data-mm="á€™á€­á€á€„á€ºá€†á€­á€¯á€„á€ºá€›á€¬ á€¡á€•á€­á€¯á€„á€ºá€¸">Maternal Portion</span></div>
        <div class="row g-3">
          <div class="col-md-3 col-sm-6">
            <label for="weight" class="form-label lang-text" data-en="Weight (Kg)" data-mm="á€€á€­á€¯á€šá€ºá€¡á€œá€±á€¸á€á€»á€­á€”á€º (á€€á€®á€œá€­á€¯á€‚á€›á€™á€º)">Weight (Kg)</label>
            <input type="number" id="weight" name="weight" class="form-control" step="0.1" min="0" max="200">
                </div>
          <div class="col-md-3 col-sm-6">
            <label for="height" class="form-label lang-text" data-en="Height (ft, inches)" data-mm="á€¡á€›á€ºá€¡á€™á€¼á€„á€·á€º (á€•á€±áŠ á€œá€€á€ºá€™)">Height (ft, inches)</label>
            <input type="text" id="height" name="height" class="form-control" placeholder="e.g., 5.4 (5ft 4in)">
                </div>
          <div class="col-md-3 col-sm-6">
            <label for="pulseRate" class="form-label lang-text" data-en="Pulse Rate (bpm)" data-mm="á€žá€½á€±á€¸á€á€¯á€”á€ºá€”á€¾á€¯á€”á€ºá€¸">Pulse Rate (bpm)</label>
            <input type="number" id="pulseRate" name="pulseRate" class="form-control" min="40" max="180">
                </div>
          <div class="col-md-3 col-sm-6">
            <label for="temperature" class="form-label lang-text" data-en="Temperature" data-mm="á€€á€­á€¯á€šá€ºá€¡á€•á€°á€á€»á€­á€”á€º">Temperature</label>
            <div class="d-flex gap-1">
              <input type="number" id="temperature" name="temperature" class="form-control" step="0.1" placeholder="37.5">
              <select id="temperatureUnit" name="temperatureUnit" class="form-control" style="width: 80px;">
                <option value="C">Â°C</option>
                <option value="F">Â°F</option>
              </select>
                </div>
              </div>
                </div>
        
        <div class="row g-3 mt-1">
          <div class="col-md-3 col-sm-6">
            <label for="bloodPressure" class="form-label lang-text" data-en="Blood Pressure (mm Hg)" data-mm="á€žá€½á€±á€¸á€•á€±á€«á€„á€ºá€á€»á€­á€”á€º (mm Hg)">Blood Pressure (mm Hg)</label>
            <input type="text" id="bloodPressure" name="bloodPressure" class="form-control" placeholder="120/80">
                </div>
                </div>

        <div class="row g-3 mt-1">
          <div class="col-md-3 col-sm-6">
            <label for="anemiaStatus" class="form-label lang-text" data-en="Anemia (Lower Inner Eyelid)" data-mm="á€žá€½á€±á€¸á€¡á€¬á€¸á€”á€Šá€ºá€¸á€á€¼á€„á€ºá€¸ á€›á€¾á€­/á€™á€›á€¾á€­ (á€¡á€±á€¬á€€á€ºá€™á€»á€€á€ºá€á€™á€ºá€¸á€¡á€á€½á€„á€ºá€¸á€˜á€€á€ºá€€á€­á€¯ á€€á€¼á€Šá€·á€ºá€›á€”á€º)">Anemia (Lower Inner Eyelid)</label>
            <select id="anemiaStatus" name="anemiaStatus" class="form-control">
              <option value="">Select</option>
              <option value="Yes">Yes</option>
              <option value="No">No</option>
            </select>
              </div>
          <div class="col-md-3 col-sm-6">
            <label for="pittingEdema" class="form-label lang-text" data-en="Edema (Leg)" data-mm="á€á€¼á€±á€–á€á€«á€¸/á€á€»á€­á€¯á€„á€·á€ºá€›á€­á€¯á€¸á€á€½á€„á€º á€›á€„á€ºá€žá€•á€ºá€›á€±á€¬á€„á€ºá€á€¼á€„á€ºá€¸ á€›á€¾á€­/á€™á€›á€¾á€­">Edema (Leg)</label>
            <select id="pittingEdema" name="pittingEdema" class="form-control">
              <option value="">Select</option>
              <option value="Yes">Yes</option>
              <option value="No">No</option>
            </select>
            </div>
          <div class="col-md-3 col-sm-6">
            <label for="bloodGroup" class="form-label lang-text" data-en="Blood Group" data-mm="á€žá€½á€±á€¸á€¡á€¯á€•á€ºá€…á€¯">Blood Group</label>
            <select id="bloodGroup" name="bloodGroup" class="form-control">
              <option value="">Select</option>
              <option value="A">A</option>
              <option value="B">B</option>
              <option value="AB">AB</option>
              <option value="O">O</option>
              <option value="Unknown">Unknown</option>
            </select>
            </div>
          <div class="col-md-3 col-sm-6">
            <label for="rhesusFactor" class="form-label lang-text" data-en="Rhesus Factor" data-mm="á€›á€­á€¯á€€á€ºá€‡á€•á€ºá€¡á€á€¼á€±á€¡á€”á€± (+/-)">Rhesus Factor</label>
            <select id="rhesusFactor" name="rhesusFactor" class="form-control">
              <option value="">Select</option>
              <option value="+">+</option>
              <option value="-">-</option>
              <option value="Unknown">Unknown</option>
            </select>
          </div>
        </div>
        
        <div class="row g-3 mt-1">
          <div class="col-md-3 col-sm-6">
            <label for="urineProtein" class="form-label lang-text" data-en="Urine Protein" data-mm="á€†á€®á€¸á€‘á€²á€á€½á€„á€º á€•á€«á€á€„á€ºá€žá€Šá€·á€º á€•á€›á€­á€¯á€á€­á€”á€ºá€¸ á€¡á€›á€Šá€ºá€¡á€á€»á€„á€ºá€¸á€¡á€› (Negative, Trace, +, ++, +++)">Urine Protein</label>
            <select id="urineProtein" name="urineProtein" class="form-control">
              <option value="">Select</option>
              <option value="Negative">Negative</option>
              <option value="Trace">Trace</option>
              <option value="+">+</option>
              <option value="++">++</option>
              <option value="+++">+++</option>
            </select>
          </div>
          <div class="col-md-3 col-sm-6">
            <label for="urineSugar" class="form-label lang-text" data-en="Urine Sugar" data-mm="á€†á€®á€¸á€‘á€²á€á€½á€„á€º á€•á€«á€á€„á€ºá€žá€Šá€·á€º á€žá€€á€¼á€¬á€¸á€¡á€›á€Šá€ºá€¡á€á€»á€„á€ºá€¸á€¡á€› (Negative, Trace, +, ++, +++)">Urine Sugar</label>
            <select id="urineSugar" name="urineSugar" class="form-control">
              <option value="">Select</option>
              <option value="Negative">Negative</option>
              <option value="Trace">Trace</option>
              <option value="+">+</option>
              <option value="++">++</option>
              <option value="+++">+++</option>
            </select>
          </div>
          <div class="col-md-6 col-sm-12">
            <label for="otherFindings" class="form-label lang-text" data-en="Other Findings" data-mm="á€¡á€á€¼á€¬á€¸ á€á€½á€±á€·á€›á€¾á€­á€á€»á€€á€ºá€™á€»á€¬á€¸">Other Findings</label>
            <input type="text" id="otherFindings" name="otherFindings" class="form-control" placeholder="Describe any other findings">
          </div>
      </div>

        <div class="row g-3 mt-1">
          <div class="col-md-4 col-sm-6">
            <label for="tbSymptoms" class="form-label lang-text" data-en="Co-infection (TB/Malaria/Immuno-suppress symptoms)" data-mm="á€€á€°á€¸á€…á€€á€ºá€›á€±á€¬á€‚á€« (TB/Malaria/Immuno-suppress á€œá€€á€¹á€á€á€¬á€™á€»á€¬á€¸)">Co-infection (TB/Malaria/Immuno-suppress symptoms)</label>
            <select id="tbSymptoms" name="tbSymptoms" class="form-control" onchange="toggleCoinfectionNotes()">
              <option value="">Select</option>
              <option value="Yes">Yes</option>
              <option value="No">No</option>
            </select>
          </div>
          <div class="col-md-4 col-sm-6" id="coinfectionNotesGroup" style="display: none;">
            <label for="coinfectionNotes" class="form-label lang-text" data-en="If yes, specify" data-mm="á€Ÿá€¯á€á€ºá€•á€«á€€ á€–á€±á€¬á€ºá€•á€¼á€›á€”á€º">If yes, specify</label>
            <input type="text" id="coinfectionNotes" name="coinfectionNotes" class="form-control" placeholder="e.g. TB symptoms, malaria">
          </div>
        </div>
      </div>

      <!-- Systemic Examination -->
      <div class="form-section">
        <h5 class="section-title">
          <i class="fas fa-user-md me-2"></i><span class="lang-text" data-en="Systemic Examination" data-mm="á€–á€¼á€…á€ºá€”á€±á€”á€­á€¯á€„á€ºá€žá€Šá€·á€º á€¡á€á€¼á€±á€¡á€”á€±á€™á€»á€¬á€¸">Systemic Examination</span>
        </h5>
        
        <div class="row g-3">
          <div class="col-md-4 col-sm-6">
            <label for="cvs" class="form-label lang-text" data-en="Cardiovascular System (CVS)" data-mm="á€”á€¾á€œá€¯á€¶á€¸á€žá€½á€±á€¸á€€á€¼á€±á€¬á€…á€”á€…á€º (CVS)">Cardiovascular System (CVS)</label>
            <input type="text" id="cvs" name="cvs" class="form-control" placeholder="CVS findings">
            </div>
          <div class="col-md-4 col-sm-6">
            <label for="rs" class="form-label lang-text" data-en="Respiratory System (RS)" data-mm="á€¡á€žá€€á€ºá€›á€¾á€°á€…á€”á€…á€º (RS)">Respiratory System (RS)</label>
            <input type="text" id="rs" name="rs" class="form-control" placeholder="RS findings">
          </div>
          <div class="col-md-4 col-sm-6">
            <label for="cns" class="form-label lang-text" data-en="Central Nervous System (CNS)" data-mm="á€¡á€¬á€›á€¯á€¶á€€á€¼á€±á€¬á€…á€”á€…á€º (CNS)">Central Nervous System (CNS)</label>
            <input type="text" id="cns" name="cns" class="form-control" placeholder="CNS findings">
          </div>
        </div>

        <div class="row g-3 mt-1">
          <div class="col-md-6 col-sm-12">
            <label for="mentalHealthStatus" class="form-label lang-text" data-en="Mental Health Status" data-mm="á€…á€­á€á€ºá€€á€»á€”á€ºá€¸á€™á€¬á€›á€±á€¸á€†á€­á€¯á€„á€ºá€›á€¬ á€œá€€á€¹á€á€á€¬á€™á€»á€¬á€¸ á€†á€”á€ºá€¸á€…á€…á€ºá€á€¼á€„á€ºá€¸">Mental Health Status</label>
            <select id="mentalHealthStatus" name="mentalHealthStatus" class="form-control">
              <option value="">Select</option>
              <option value="stable" class="lang-text" data-en="Stable" data-mm="á€…á€­á€á€ºá€¡á€á€¼á€±á€¡á€”á€± á€•á€¼á€¯á€¶á€¸á€™á€±á€¬á€”á€±á€á€¼á€„á€ºá€¸">Stable</option>
              <option value="worry" class="lang-text" data-en="Worry" data-mm="á€…á€­á€¯á€¸á€›á€­á€™á€ºá€•á€°á€•á€”á€ºá€”á€±á€á€¬">Worry</option>
              <option value="fear" class="lang-text" data-en="Fear" data-mm="á€€á€¼á€±á€¬á€€á€ºá€›á€½á€¶á€·á€á€¼á€„á€ºá€¸">Fear</option>
              <option value="changes_in_sleep_pattern" class="lang-text" data-en="Changes in sleep pattern" data-mm="á€¡á€­á€•á€ºá€á€»á€­á€”á€ºá€•á€¼á€±á€¬á€„á€ºá€¸á€œá€²á€á€¼á€„á€ºá€¸">Changes in sleep pattern</option>
              <option value="changes_in_appetite" class="lang-text" data-en="Changes in appetite" data-mm="á€…á€¬á€¸á€á€»á€­á€”á€ºá€•á€¼á€±á€¬á€„á€ºá€¸á€œá€²á€á€¼á€„á€ºá€¸">Changes in appetite</option>
            </select>
            </div>
            </div>
          </div>
          
      <!-- Abdominal Examination -->
      <div class="form-section">
        <h5 class="section-title">
          <i class="fas fa-hand-holding-medical me-2"></i><span class="lang-text" data-en="Abdominal Examination" data-mm="á€—á€­á€¯á€€á€ºá€”á€±á€›á€¬á€€á€­á€¯ á€žá€±á€á€»á€¬ á€…á€™á€ºá€¸á€žá€•á€ºá€…á€…á€ºá€†á€±á€¸á€á€¼á€„á€ºá€¸">Abdominal Examination</span>
        </h5>

        <div class="card-subtitle"><i class="fas fa-baby me-2"></i><span class="lang-text" data-en="Fetal Portion" data-mm="á€žá€”á€¹á€“á€±á€žá€¬á€¸á€†á€­á€¯á€„á€ºá€›á€¬ á€¡á€•á€­á€¯á€„á€ºá€¸">Fetal Portion</span></div>
        <div class="row g-3">
          <div class="col-md-4 col-sm-6">
            <label for="fundalHeight" class="form-label lang-text" data-en="Fundal Height (cm)" data-mm="á€žá€”á€¹á€“á€±á€žá€¬á€¸á€›á€¾á€­á€›á€¬á€”á€±á€›á€¬ á€¡á€™á€¼á€„á€·á€º (cm)">Fundal Height (cm)</label>
              <input type="number" id="fundalHeight" name="fundalHeight" class="form-control" step="0.1" min="0" max="50">
            </div>
          <div class="col-md-4 col-sm-6">
            <label for="fetalLie" class="form-label lang-text" data-en="Lie of Fetus (Longitudinal, Transverse, Oblique)" data-mm="á€žá€”á€¹á€“á€±á€žá€¬á€¸á á€¡á€”á€±á€¡á€‘á€¬á€¸ ">Lie of Fetus (Longitudinal, Transverse, Oblique)</label>
            <select id="fetalLie" name="fetalLie" class="form-control">
              <option value="">Select</option>
              <option value="Longitudinal" class="lang-text" data-en="Longitudinal" data-mm="á€œá€­á€¯á€„á€ºá€”á€¬">Longitudinal</option>
              <option value="Transverse" class="lang-text" data-en="Transverse" data-mm="á€á€»á€±á€¬á€„á€·á€ºá€–á€¼á€á€º">Transverse</option>
              <option value="Oblique" class="lang-text" data-en="Oblique" data-mm="á€œá€­á€™á€ºá€á€¼á€±á€¬á€€á€º">Oblique</option>
            </select>
          </div>
          <div class="col-md-4 col-sm-6">
            <label for="fetalPresentation" class="form-label lang-text" data-en="Presentation of Fetus" data-mm="á€žá€”á€¹á€“á€±á€žá€¬á€¸ á€¦á€¸á€á€±á€«á€„á€ºá€¸á€†á€­á€¯á€„á€ºá€›á€¬">Presentation of Fetus</label>
              <select id="fetalPresentation" name="fetalPresentation" class="form-control">
                <option value="">Select</option>
              <option value="Cephalic" class="lang-text" data-en="Cephalic" data-mm="á€¦á€¸á€á€±á€«á€„á€ºá€¸">Cephalic</option>
              <option value="Breech" class="lang-text" data-en="Breech" data-mm="á€á€«á€¸á€¡á€±á€¬á€€á€º">Breech</option>
              <option value="Transverse" class="lang-text" data-en="Transverse" data-mm="â€Œ">Transverse</option>
              <option value="Other" class="lang-text" data-en="Other" data-mm="á€¡á€á€¼á€¬á€¸">Other</option>
              </select>
            </div>
          </div>
          
        <div class="row g-3 mt-1">
          <div class="col-md-4 col-sm-6">
            <label for="fetalHeartRate" class="form-label lang-text" data-en="Fetal Heart Rate (bpm) (>20 Weeks)" data-mm="á€žá€”á€¹á€“á€±á€žá€¬á€¸á€”á€¾á€œá€¯á€¶á€¸á€á€¯á€”á€ºá€”á€¾á€¯á€”á€ºá€¸ (bpm) (á€€á€­á€¯á€šá€ºá€á€”á€º á‚á€ á€•á€á€º á€¡á€‘á€€á€ºá€á€½á€„á€º á€”á€¬á€¸á€‘á€±á€¬á€„á€ºá€›á€”á€º)">Fetal Heart Rate (bpm) (>20 Weeks)</label>
              <input type="number" id="fetalHeartRate" name="fetalHeartRate" class="form-control" min="100" max="180">
            </div>
          <div class="col-md-4 col-sm-6">
            <label class="form-label lang-text" data-en="Fetal Movement (>20 Weeks)" data-mm="á€žá€”á€¹á€“á€±á€žá€¬á€¸á€œá€¾á€¯á€•á€ºá€›á€¾á€¬á€¸á€™á€¾á€¯ á€›á€¾á€­/á€™á€›á€¾á€­ (á€€á€­á€¯á€šá€ºá€á€”á€º á‚á€ á€•á€á€º á€¡á€‘á€€á€ºá€á€½á€„á€º á€…á€™á€ºá€¸á€žá€•á€ºá€›á€”á€º)">Fetal Movement (>20 Weeks)</label>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="fetalMovement" id="fetalMovementYes" value="Yes">
              <label class="form-check-label" for="fetalMovementYes">Yes</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="fetalMovement" id="fetalMovementNo" value="No">
              <label class="form-check-label" for="fetalMovementNo">No</label>
            </div>
            </div>
          </div>
          
        <div class="row g-3 mt-1">
          <div class="col-md-4 col-sm-6">
            <label for="initial" class="form-label lang-text" data-en="Initial" data-mm="á€¡á€™á€Šá€ºá€¡á€á€­á€¯á€€á€±á€¬á€€á€º">Initial</label>
            <input type="text" id="initial" name="initial" class="form-control" placeholder="Initials">
            </div>
            </div>

          </div>
          
      <!-- High Risk Pregnancy Assessment -->
      <div class="form-section">
        <h5 class="section-title">
          <i class="fas fa-exclamation-triangle me-2"></i><span class="lang-text" data-en="High Risk Pregnancy Assessment" data-mm="á€¡á€”á€¹á€á€›á€¬á€šá€ºá€–á€¼á€…á€ºá€”á€­á€¯á€„á€ºá€á€»á€±á€›á€¾á€­á€žá€±á€¬ á€€á€­á€¯á€šá€ºá€á€”á€ºá€†á€±á€¬á€„á€º á€Ÿá€¯á€á€º/á€™á€Ÿá€¯á€á€º á€†á€”á€ºá€¸á€…á€…á€ºá€á€¼á€„á€ºá€¸">High Risk Pregnancy Assessment</span>
        </h5>
        
        <div class="mt-2">
          <div class="form-check">
            <input class="form-check-input" type="radio" name="highRisk" id="highRiskNo" value="no" checked onchange="toggleHighRiskDetails()">
            <label class="form-check-label lang-text" data-en="No - Standard risk pregnancy" data-mm="á€¡á€”á€¹á€á€›á€¬á€šá€ºá€›á€¾á€­ á€€á€­á€¯á€šá€ºá€á€”á€ºá€†á€±á€¬á€„á€º á€™á€Ÿá€¯á€á€ºá€•á€«á‹">No - Standard risk pregnancy</label>
            </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="highRisk" id="highRiskYes" value="yes" onchange="toggleHighRiskDetails()">
            <label class="form-check-label lang-text" data-en="Yes - High risk pregnancy" data-mm="á€¡á€”á€¹á€á€›á€¬á€šá€ºá€›á€¾á€­ á€€á€­á€¯á€šá€ºá€á€”á€ºá€†á€±á€¬á€„á€º á€–á€¼á€…á€ºá€žá€Šá€ºá‹">Yes - High risk pregnancy</label>
          </div>
        </div>

        <div id="highRiskDetails" class="row g-3 mt-2" style="display: none;">
          <div class="col-md-12">
            <label class="form-label lang-text" data-en="High Risk Factors (Select all that apply):" data-mm="á€¡á€”á€¹á€á€›á€¬á€šá€ºá€–á€¼á€…á€ºá€”á€­á€¯á€„á€ºá€á€¼á€±á€›á€¾á€­á€žá€±á€¬ á€¡á€á€»á€€á€ºá€¡á€œá€€á€ºá€™á€»á€¬á€¸ (á€€á€­á€¯á€€á€ºá€Šá€®á€žá€±á€¬á€¡á€€á€¼á€±á€¬á€„á€ºá€¸á€¡á€›á€¬á€¡á€¬á€¸á€œá€¯á€¶á€¸á€€á€­á€¯ á€›á€½á€±á€¸á€á€»á€šá€ºá€”á€­á€¯á€„á€ºá€•á€«á€žá€Šá€º):">High Risk Factors (Select all that apply):</label>
            <div class="row">
              <div class="col-md-6">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="riskFactors" id="riskAge" value="maternal_age_18_or_35">
                  <label class="form-check-label lang-text" data-en="Maternal age <18 or >35 years" data-mm="á€™á€­á€á€„á€ºá€¡á€žá€€á€º (ááˆ) á€”á€¾á€…á€ºá€¡á€±á€¬á€€á€º (á€žá€­á€¯á€·) (áƒá…) á€”á€¾á€…á€ºá€¡á€‘á€€á€º">Maternal age <18 or >35 years</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="riskFactors" id="riskParity" value="parity_5">
                  <label class="form-check-label lang-text" data-en="Parity â‰¥ 5" data-mm="á€€á€­á€¯á€šá€ºá€á€”á€ºá€†á€±á€¬á€„á€ºá€¡á€€á€¼á€­á€™á€º (á…) á€€á€¼á€­á€™á€ºá€”á€¾á€„á€·á€ºá€¡á€‘á€€á€º">Parity â‰¥ 5</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="riskFactors" id="riskMultiple" value="multiple_pregnancy">
                  <label class="form-check-label lang-text" data-en="Multiple pregnancy" data-mm="á€¡á€™á€½á€¾á€¬á€€á€­á€¯á€šá€ºá€á€”á€º">Multiple pregnancy</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="riskFactors" id="riskPrevious" value="previous_complications">
                  <label class="form-check-label lang-text" data-en="History of complications in previous pregnancies" data-mm="á€šá€á€„á€º á€€á€­á€¯á€šá€ºá€á€”á€ºá€†á€±á€¬á€„á€ºá€…á€‰á€ºá€á€½á€„á€º á€•á€¼á€„á€ºá€¸á€‘á€”á€ºá€žá€Šá€·á€º á€¡á€”á€¬á€‚á€á€ºá€†á€­á€¯á€„á€ºá€›á€¬ á€•á€¼á€¿á€”á€¬á€™á€»á€¬á€¸ á€–á€¼á€…á€ºá€–á€½á€¬á€¸á€á€²á€·á€á€¼á€„á€ºá€¸">History of complications in previous pregnancies</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="riskFactors" id="riskStillbirth" value="previous_stillbirths">
                  <label class="form-check-label lang-text" data-en="Previous stillbirths or neonatal deaths" data-mm="á€šá€á€„á€º á€™á€½á€±á€¸á€–á€½á€¬á€¸á€žá€Šá€·á€º á€€á€œá€±á€¸ á€žá€±á€†á€¯á€¶á€¸á€á€²á€·á€á€¼á€„á€ºá€¸ (á€žá€­á€¯á€·) á€™á€½á€±á€¸á€–á€½á€¬á€¸á€•á€¼á€®á€¸á€”á€±á€¬á€€á€º á€žá€”á€ºá€·á€›á€¾á€„á€ºá€¸á€›á€±á€¸á€§á€›á€­á€šá€¬á€á€½á€„á€º á€žá€±á€†á€¯á€¶á€¸á€á€²á€·á€á€¼á€„á€ºá€¸">Previous stillbirths or neonatal deaths</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="riskFactors" id="riskPreterm" value="previous_preterm">
                  <label class="form-check-label lang-text" data-en="Previous preterm births" data-mm="á€¡á€á€»á€­á€”á€ºá€™á€á€­á€¯á€„á€ºá€™á€® á€™á€½á€±á€¸á€–á€½á€¬á€¸á€á€²á€·á€á€¼á€„á€ºá€¸">Previous preterm births</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="riskFactors" id="riskObstructed" value="obstructed_labour">
                  <label class="form-check-label lang-text" data-en="History of obstructed labour, prolonged labour, or cesarean section" data-mm="á€šá€á€„á€º á€™á€½á€±á€¸á€–á€½á€¬á€¸á€…á€‰á€º á€žá€¬á€¸á€¡á€­á€™á€ºá€•á€­á€á€ºá€†á€­á€¯á€·á€á€¼á€„á€ºá€¸áŠ á€™á€½á€±á€¸á€–á€½á€¬á€¸á€á€»á€­á€”á€ºá€€á€¼á€¬á€™á€¼á€„á€·á€ºá€á€¼á€„á€ºá€¸ (á€žá€­á€¯á€·) á€žá€¬á€¸á€–á€½á€¬á€¸á€á€½á€² á€á€½á€²á€…á€­á€á€ºá€›á€á€²á€·á€á€¼á€„á€ºá€¸">History of obstructed labour, prolonged labour, or cesarean section</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="riskFactors" id="riskUterineScar" value="uterine_scar">
                  <label class="form-check-label lang-text" data-en="Uterine scar" data-mm="á€žá€¬á€¸á€¡á€­á€™á€ºá€¡á€”á€¬á€›á€¾á€­á€á€¼á€„á€ºá€¸">Uterine scar</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="riskFactors" id="riskHypertension" value="hypertension">
                  <label class="form-check-label lang-text" data-en="Hypertension" data-mm="á€žá€½á€±á€¸á€•á€±á€«á€„á€ºá€á€»á€­á€”á€ºá€™á€¼á€„á€·á€ºá€á€¼á€„á€ºá€¸">Hypertension</label>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="riskFactors" id="riskDiabetes" value="diabetes">
                  <label class="form-check-label lang-text" data-en="Diabetes mellitus" data-mm="á€†á€®á€¸á€á€»á€­á€¯á€›á€±á€¬á€‚á€«á€›á€¾á€­á€á€¼á€„á€ºá€¸">Diabetes mellitus</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="riskFactors" id="riskCardiac" value="cardiac_disease">
                  <label class="form-check-label lang-text" data-en="Cardiac disease" data-mm="á€”á€¾á€œá€¯á€¶á€¸á€›á€±á€¬á€‚á€«á€›á€¾á€­á€á€¼á€„á€ºá€¸">Cardiac disease</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="riskFactors" id="riskTB" value="tuberculosis">
                  <label class="form-check-label lang-text" data-en="Tuberculosis" data-mm="á€€á€„á€ºá€†á€¬á€›á€±á€¬á€‚á€«á€›á€¾á€­á€á€¼á€„á€ºá€¸">Tuberculosis</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="riskFactors" id="riskEpilepsy" value="epilepsy">
                  <label class="form-check-label lang-text" data-en="Epilepsy" data-mm="á€¡á€¬á€›á€¯á€¶á€€á€¼á€±á€¬á€›á€±á€¬á€‚á€« (Epilepsy) á€›á€¾á€­á€á€¼á€„á€ºá€¸">Epilepsy</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="riskFactors" id="riskKidney" value="kidney_disease">
                  <label class="form-check-label lang-text" data-en="Kidney disease" data-mm="á€€á€»á€±á€¬á€€á€ºá€€á€•á€ºá€›á€±á€¬á€‚á€«á€›á€¾á€­á€á€¼á€„á€ºá€¸">Kidney disease</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="riskFactors" id="riskHIV" value="hiv">
                  <label class="form-check-label lang-text" data-en="HIV infection" data-mm="HIV á€›á€±á€¬á€‚á€«á€€á€°á€¸á€…á€€á€ºá€á€¶á€‘á€¬á€¸á€›á€á€¼á€„á€ºá€¸">HIV infection</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="riskFactors" id="riskCongenital" value="previous_congenital_anomalies">
                  <label class="form-check-label lang-text" data-en="Previous child with congenital anomalies" data-mm="á€šá€á€„á€º á€™á€½á€±á€¸á€–á€½á€¬á€¸á€á€²á€·á€žá€Šá€·á€º á€€á€œá€±á€¸á€á€½á€„á€º á€¡á€€á€½á€²á€¡á€•á€¼á€¬á€¸á€™á€»á€¬á€¸ (á€žá€­á€¯á€·) á€€á€­á€¯á€šá€ºá€á€”á€¹á€“á€¬á€†á€­á€¯á€„á€ºá€›á€¬ á€™á€Šá€®á€™á€»á€¾á€™á€¾á€¯á€™á€»á€¬á€¸ á€›á€¾á€­á€á€²á€·á€á€¼á€„á€ºá€¸">Previous child with congenital anomalies</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="riskFactors" id="riskShortInterval" value="short_interval_pregnancy">
                  <label class="form-check-label lang-text" data-en="Short interval between pregnancies" data-mm="á€€á€­á€¯á€šá€ºá€á€”á€ºá€†á€±á€¬á€„á€ºá€€á€¬á€œ á€€á€¼á€¬á€á€»á€­á€”á€ºá€¡á€á€­á€¯ (á€™á€½á€±á€¸á€–á€½á€¬á€¸á€•á€¼á€®á€¸á€”á€±á€¬á€€á€º á€™á€€á€¼á€¬á€á€„á€º á€•á€¼á€”á€ºá€œá€Šá€º á€€á€­á€¯á€šá€ºá€á€”á€ºá€†á€±á€¬á€„á€ºá€œá€¬á€á€¼á€„á€ºá€¸)">Short interval between pregnancies</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="riskFactors" id="riskPlacenta" value="placenta_previa_abruption">
                  <label class="form-check-label lang-text" data-en="Placenta previa/Abruption" data-mm="á€šá€á€„á€º á€™á€½á€±á€¸á€–á€½á€¬á€¸á€…á€‰á€º á€žá€½á€±á€¸á€‘á€½á€€á€ºá€žá€½á€¬á€¸á€á€²á€·á€á€¼á€„á€ºá€¸ (Placenta previa/abruption)">Placenta previa/Abruption</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="riskFactors" id="riskOther" value="other_medical_conditions">
                  <label class="form-check-label lang-text" data-en="Other Medical Conditions" data-mm="á€¡á€á€¼á€¬á€¸á€€á€»á€”á€ºá€¸á€™á€¬á€›á€±á€¸á€•á€¼á€¿á€”á€¬á€™á€»á€¬á€¸">Other Medical Conditions</label>
            </div>
          </div>
        </div>

            <div class="alert alert-info mt-3">
              <i class="fas fa-info-circle me-2"></i>
              <span class="lang-text" data-en="Women with one or more of the above conditions should deliver only at a hospital. They should also make the necessary preparations for childbirth in advance." data-mm="á€¡á€‘á€€á€ºá€•á€«á€¡á€á€¼á€±á€¡á€”á€±á€á€…á€ºá€á€¯á€á€¯ (á€žá€­á€¯á€·) á€á€…á€ºá€á€¯á€‘á€•á€ºá€•á€­á€¯á€›á€¾á€­á€žá€±á€¬ á€¡á€™á€»á€­á€¯á€¸á€žá€™á€®á€¸á€™á€»á€¬á€¸á€žá€Šá€º â€Œá€†á€±á€¸á€›á€¯á€¶á€¡á€†á€„á€·á€ºá€á€½á€„á€ºá€žá€¬ á€™á€½á€±á€¸á€–á€½á€¬á€¸á€žá€„á€·á€ºá€€á€¼á€±á€¬á€„á€ºá€¸ á€›á€¾á€„á€ºá€¸á€•á€¼á€›á€™á€Šá€ºá‹ á€™á€½á€±á€¸á€–á€½á€¬á€¸á€›á€”á€º á€€á€¼á€­á€¯á€á€„á€ºá€•á€¼á€„á€ºá€†á€„á€ºá€™á€¾á€¯á€™á€»á€¬á€¸ á€†á€±á€¬á€„á€ºá€›á€½á€€á€ºá€›á€”á€ºá‹">Women with one or more of the above conditions should deliver only at a hospital. They should also make the necessary preparations for childbirth in advance.</span>
            </div>
            
            <label class="form-label mt-2 lang-text" data-en="Additional Notes:&#10;Describe any other risks or concerns" data-mm="á€™á€¾á€á€ºá€á€»á€€á€ºá‹&#10;á€¡á€”á€¹á€á€›á€¬á€šá€ºá€–á€¼á€…á€ºá€”á€­á€¯á€„á€ºá€á€¼á€±á€›á€¾á€­á€žá€±á€¬ á€¡á€á€¼á€¬á€¸á€¡á€á€¼á€±á€¡á€”á€±á€™á€»á€¬á€¸á€›á€¾á€­á€œá€»á€¾á€„á€º á€–á€±á€¬á€ºá€•á€¼á€•á€«á‹" for="riskNotes">Additional Notes:<br>Describe any other risks or concerns</label>
            <textarea name="riskNotes" id="riskNotes" class="form-control" rows="2" placeholder="Describe any other risk factors or concerns"></textarea>
          </div>
        </div>
      </div>
        
      <!-- Treatment & Medications -->
      <div class="form-section">
        <h5 class="section-title">
          <i class="fas fa-syringe me-2"></i><span class="lang-text" data-en="Treatment & Medications" data-mm="á€€á€¯á€žá€™á€¾á€¯ á€”á€¾á€„á€·á€º á€†á€±á€¸á€•á€±á€¸á€á€¼á€„á€ºá€¸á€™á€»á€¬á€¸">Treatment & Medications</span>
        </h5>
        
        <div class="card-subtitle"><i class="fas fa-pills me-2"></i><span class="lang-text" data-en="Iron & Folic Acid Tablet" data-mm="á€žá€¶á€“á€«á€á€ºá€”á€¾á€„á€·á€º á€–á€±á€¬á€œá€…á€ºá€¡á€€á€ºá€†á€…á€º á€¡á€¬á€¸á€†á€±á€¸">Iron & Folic Acid Tablet</span></div>
        <div class="row g-3">
          <div class="col-md-4 col-sm-6">
            <label for="ironFolicAcid" class="form-label lang-text" data-en="Iron & Folic Acid" data-mm="á€žá€¶á€“á€«á€á€ºá€”á€¾á€„á€·á€º á€–á€±á€¬á€œá€…á€ºá€¡á€€á€ºá€†á€…á€º">Iron & Folic Acid</label>
              <select id="ironFolicAcid" name="ironFolicAcid" class="form-control">
                <option value="">Select</option>
                <option value="Given">Given</option>
                <option value="Not Given">Not Given</option>
              </select>
            </div>
        </div>

        <div class="card-subtitle mt-3"><i class="fas fa-capsules me-2"></i><span class="lang-text" data-en="Vitamin B1" data-mm="á€—á€®á€á€¬á€™á€„á€ºá€˜á€®á€á€™á€ºá€¸ á€¡á€¬á€¸á€†á€±á€¸">Vitamin B1</span></div>
        <div class="row g-3">
          <div class="col-md-4 col-sm-6">
            <label for="vitaminB1" class="form-label lang-text" data-en="Vitamin B1" data-mm="á€—á€®á€á€¬á€™á€„á€ºá€˜á€®á€á€™á€ºá€¸">Vitamin B1</label>
            <select id="vitaminB1" name="vitaminB1" class="form-control">
                <option value="">Select</option>
              <option value="Given">Given</option>
                <option value="Not Given">Not Given</option>
              </select>
            </div>
          </div>
          
        <div class="card-subtitle mt-3"><i class="fas fa-tablets me-2"></i><span class="lang-text" data-en="Deworming" data-mm="á€žá€”á€ºá€á€»á€†á€±á€¸á€•á€¼á€¬á€¸">Deworming</span></div>
        <div class="row g-3">
          <div class="col-md-4 col-sm-6">
            <label for="deworming" class="form-label lang-text" data-en="Deworming" data-mm="á€žá€”á€ºá€á€»á€†á€±á€¸">Deworming</label>
            <select id="deworming" name="deworming" class="form-control">
              <option value="">Select</option>
              <option value="Yes">Yes</option>
              <option value="No">No</option>
            </select>
            </div>
          </div>
          
        <div class="row g-3 mt-1">
          <div class="col-md-4 col-sm-6">
            <label for="tetanusToxoid" class="form-label lang-text" data-en="Tetanus Diphtheria (TD)" data-mm="á€™á€±á€¸á€á€­á€¯á€„á€ºáŠ á€†á€¯á€¶á€†á€­á€¯á€·á€”á€¬ á€€á€¬á€€á€½á€šá€ºá€†á€±á€¸">Tetanus Diphtheria (TD)</label>
            <select id="tetanusToxoid" name="tetanusToxoid" class="form-control">
                <option value="">Select</option>
              <option value="TD1">TD1</option>
              <option value="TD2">TD2</option>
              <option value="Not Given">Not Given</option>
              </select>
            </div>
          </div>
          
        <div class="row g-3 mt-1">
          <div class="col-12">
            <label for="otherMedications" class="form-label lang-text" data-en="Other Medications" data-mm="á€¡á€á€¼á€¬á€¸á€žá€±á€¬ á€†á€±á€¸á€•á€±á€¸á€á€¼á€„á€ºá€¸á€™á€»á€¬á€¸ á€™á€¾á€á€ºá€á€™á€ºá€¸á€á€„á€ºá€›á€”á€º">Other Medications</label>
            <textarea id="otherMedications" name="otherMedications" class="form-control" rows="3" placeholder="Include additional medications"></textarea>
        </div>
        </div>
      </div>

      <!-- Clinical Notes & Next Steps -->
      <div class="form-section">
        <h5 class="section-title">
          <i class="fas fa-notes-medical me-2"></i><span class="lang-text" data-en="Clinical Notes & Next Steps" data-mm="á€€á€¯á€žá€™á€¾á€¯ á€™á€¾á€á€ºá€…á€¯á€™á€»á€¬á€¸á€”á€¾á€„á€·á€º á€”á€±á€¬á€€á€ºá€‘á€•á€º á€¡á€†á€„á€·á€ºá€™á€»á€¬á€¸">Clinical Notes & Next Steps</span>
        </h5>
        
        <div class="row g-3">
          <div class="col-md-6">
            <label for="nextVisitDate" class="form-label lang-text" data-en="Follow-up Appointment&#10;Follow-up Date - (mm/dd/yyyy)" data-mm="á€”á€±á€¬á€€á€ºá€á€…á€ºá€€á€¼á€­á€™á€º á€•á€¼á€”á€ºá€•á€¼á€›á€”á€º á€›á€€á€ºá€á€»á€­á€”á€ºá€¸á€•á€±á€¸á€á€¼á€„á€ºá€¸&#10;á€•á€¼á€”á€ºá€•á€¼á€›á€™á€Šá€·á€º á€›á€€á€ºá€…á€½á€² - (á€œ/á€›á€€á€ºá€…á€½á€²/á€á€¯á€”á€¾á€…á€º)">Follow-up Appointment<br>Follow-up Date - (mm/dd/yyyy)</label>
            <div class="d-flex gap-2">
              <input type="date" id="nextVisitDate" name="nextVisitDate" class="form-control">
              <button type="button" class="quick-fill-btn" onclick="setNextMonth('nextVisitDate')">+4 weeks</button>
            </div>
            <small class="form-hint lang-text" data-en="To provide support for birth preparedness begin from 5th and 6th month (2nd and 3rd ANC visit)" data-mm="á€€á€­á€¯á€šá€ºá€á€”á€º á…á€œ á€”á€¾á€„á€·á€º á†á€œ (á€’á€¯á€á€­á€šá€¡á€€á€¼á€­á€™á€ºá€”á€¾á€„á€·á€º á€á€á€­á€šá€¡á€€á€¼á€­á€™á€º) á€™á€¾á€…á á€™á€½á€±á€¸á€–á€½á€¬á€¸á€›á€”á€ºá€€á€¼á€­á€¯á€á€„á€ºá€•á€¼á€„á€ºá€†á€„á€ºá€›á€±á€¸á€¡á€á€½á€€á€º á€€á€°á€Šá€®á€•á€±á€¸á€›á€”á€º">To provide support for birth preparedness begin from 5th and 6th month (2nd and 3rd ANC visit)</small>
          </div>
        </div>

        <div class="row g-3 mt-1">
          <div class="col-12">
            <label for="clinicalNotes" class="form-label lang-text" data-en="Clinical Notes & Recommendations" data-mm="á€†á€±á€¸á€€á€¯á€žá€™á€¾á€¯á€™á€¾á€á€ºá€á€™á€ºá€¸ á€”á€¾á€„á€·á€º á€¡á€€á€¼á€¶á€•á€¼á€¯á€á€»á€€á€ºá€™á€»á€¬á€¸">Clinical Notes & Recommendations</label>
            <textarea class="form-control" id="clinicalNotes" name="clinicalNotes" rows="3" placeholder="Additional clinical observations and recommendations"></textarea>
          </div>
        </div>

        <!-- Danger Signs Assessment Section -->
        <div class="card-subtitle mt-4"><i class="fas fa-exclamation-triangle me-2"></i><span class="lang-text" data-en="Danger Signs Assessment" data-mm="á€¡á€”á€¹á€á€›á€¬á€šá€ºá€œá€€á€¹á€á€á€¬á€™á€»á€¬á€¸á€€á€­á€¯ á€†á€”á€ºá€¸á€…á€…á€ºá€á€¼á€„á€ºá€¸">Danger Signs Assessment</span></div>
        
        <div class="alert alert-warning mt-2" role="alert">
          <i class="fas fa-info-circle me-2"></i><span class="lang-text" data-en="Use the danger signs checklist below to counsel the client and plan referrals." data-mm="á€¡á€±á€¬á€€á€ºá€•á€« á€¡á€”á€¹á€á€›á€¬á€šá€ºá€œá€€á€¹á€á€á€¬á€™á€»á€¬á€¸ á€…á€¬á€›á€„á€ºá€¸á€€á€­á€¯ á€¡á€žá€¯á€¶á€¸á€•á€¼á€¯á á€œá€°á€”á€¬á€€á€­á€¯ á€¡á€€á€¼á€¶á€•á€±á€¸á€›á€”á€ºá€”á€¾á€„á€·á€º á€œá€½á€¾á€²á€•á€¼á€±á€¬á€„á€ºá€¸á€Šá€½á€¾á€”á€ºá€¸á€•á€­á€¯á€·á€™á€¾á€¯ á€…á€®á€…á€‰á€ºá€›á€”á€ºá‹">Use the danger signs checklist below to counsel the client and plan referrals.</span>
        </div>
        
        <div id="dangerSignsDetails">
          <div class="row g-3">
            <div class="col-md-6">
              <div class="card danger-signs-card">
                <div class="card-header">
                  <h6 class="mb-0"><i class="fas fa-exclamation-circle me-2"></i><span class="lang-text" data-en="Danger Signs in Pregnancy" data-mm="á€€á€­á€¯á€šá€ºá€á€”á€ºá€†á€±á€¬á€„á€ºá€…á€¥á€º á€¡á€”á€¹á€á€›á€¬á€šá€ºá€œá€€á€¹á€á€á€¬á€™á€»á€¬á€¸">Danger Signs in Pregnancy</span></h6>
                </div>
                <div class="card-body">
                  <h6 class="text-danger lang-text" data-en="If the symptoms below occur, please go urgently to health facility:&#10;- Severe abdominal pain&#10;- Vaginal bleeding&#10;- Severe headache / blurred vision&#10;- Swelling of face / hands&#10;- Convulsions&#10;- Fever with chills&#10;- Reduced or absent fetal movement (after 20 weeks)&#10;- Other symptoms which make woman feel very unwell" data-mm="á€¡á€±á€¬á€€á€ºá€•á€« á€œá€€á€¹á€á€á€¬á€™á€»á€¬á€¸ á€–á€¼á€…á€ºá€•á€±á€«á€ºá€•á€«á€€ á€€á€»á€”á€ºá€¸á€™á€¬á€›á€±á€¸á€Œá€¬á€”á€žá€­á€¯á€· á€á€»á€€á€ºá€á€»á€„á€ºá€¸ á€žá€½á€¬á€¸á€›á€™á€Šá€ºá‹&#10;- á€á€™á€ºá€¸á€—á€­á€¯á€€á€ºá€¡á€±á€¬á€€á€ºá€•á€­á€¯á€„á€ºá€¸á€á€½á€„á€º á€”á€¬á€á€¬á€™á€¼á€„á€·á€ºá€…á€½á€¬ á€”á€¬á€€á€»á€„á€ºá€™á€¾á€¯á€›á€¾á€­á€á€¼á€„á€ºá€¸&#10;- á€™á€­á€”á€ºá€¸á€™á€€á€­á€¯á€šá€ºá€™á€¾ á€žá€½á€±á€¸á€†á€„á€ºá€¸á€á€¼á€„á€ºá€¸&#10;- á€•á€¼á€„á€ºá€¸á€‘á€”á€ºá€…á€½á€¬ á€á€±á€«á€„á€ºá€¸á€€á€­á€¯á€€á€ºá€á€¼á€„á€ºá€¸áŠ á€¡á€™á€¼á€„á€ºá€™á€¾á€¯á€”á€ºá€á€«á€¸á€á€¼á€„á€ºá€¸&#10;- á€™á€»á€€á€ºá€”á€¾á€¬/á€œá€€á€º/á€á€¼á€±á€™á€»á€¬á€¸ á€á€½á€„á€º á€›á€„á€ºá€žá€•á€ºá€›á€±á€¬á€„á€ºá€á€¼á€„á€ºá€¸&#10;- á€á€€á€ºá€á€¼á€„á€ºá€¸&#10;- á€–á€»á€¬á€¸á€•á€¼á€®á€¸ á€á€¯á€”á€ºá€œá€¾á€¯á€•á€ºá€”á€±á€œá€»á€¾á€„á€º&#10;- á€€á€­á€¯á€šá€ºá€á€”á€º á‚á€á€•á€á€º á€¡á€‘á€€á€ºá€á€½á€„á€º á€žá€”á€¹á€“á€±á€žá€¬á€¸á€œá€¾á€¯á€•á€ºá€›á€¾á€¬á€¸á€™á€¾á€¯ á€œá€»á€±á€¬á€·á€”á€Šá€ºá€¸á€á€¼á€„á€ºá€¸ (á€žá€­á€¯á€·) á€œá€¯á€¶á€¸á€ á€™á€á€¶á€…á€¬á€¸á€›á€á€¼á€„á€ºá€¸&#10;- á€¡á€á€¼á€¬á€¸á€”á€±á€‘á€­á€¯á€„á€ºá€™á€€á€±á€¬á€„á€ºá€¸á€–á€¼á€…á€ºá€œá€»á€¾á€„á€º">If the symptoms below occur, please go urgently to health facility:<br>- Severe abdominal pain<br>- Vaginal bleeding<br>- Severe headache / blurred vision<br>- Swelling of face / hands<br>- Convulsions<br>- Fever with chills<br>- Reduced or absent fetal movement (after 20 weeks)<br>- Other symptoms which make woman feel very unwell</h6>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="ds_vaginal_bleeding" name="ds_vaginal_bleeding">
                    <label class="form-check-label lang-text" data-en="Vaginal bleeding" data-mm="á€™á€­á€”á€ºá€¸á€™á€€á€­á€¯á€šá€ºá€™á€¾ á€žá€½á€±á€¸á€†á€„á€ºá€¸á€á€¼á€„á€ºá€¸" for="ds_vaginal_bleeding">Vaginal bleeding</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="ds_convulsions" name="ds_convulsions">
                    <label class="form-check-label lang-text" data-en="Convulsions" data-mm="á€á€€á€ºá€á€¼á€„á€ºá€¸" for="ds_convulsions">Convulsions</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="ds_loss_consciousness" name="ds_loss_consciousness">
                    <label class="form-check-label lang-text" data-en="Loss of consciousness" data-mm="á€žá€á€­á€œá€…á€ºá€á€¼á€„á€ºá€¸" for="ds_loss_consciousness">Loss of consciousness</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="ds_severe_headache" name="ds_severe_headache">
                    <label class="form-check-label lang-text" data-en="Severe headache" data-mm="á€•á€¼á€„á€ºá€¸á€‘á€”á€ºá€…á€½á€¬ á€á€±á€«á€„á€ºá€¸á€€á€­á€¯á€€á€ºá€á€¼á€„á€ºá€¸" for="ds_severe_headache">Severe headache</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="ds_blurred_vision" name="ds_blurred_vision">
                    <label class="form-check-label lang-text" data-en="Blurred vision" data-mm="á€¡á€™á€¼á€„á€ºá€™á€¾á€¯á€”á€ºá€á€«á€¸á€á€¼á€„á€ºá€¸" for="ds_blurred_vision">Blurred vision</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="ds_vomiting" name="ds_vomiting">
                    <label class="form-check-label lang-text" data-en="Vomiting" data-mm="á€¡á€”á€ºá€á€¼á€„á€ºá€¸" for="ds_vomiting">Vomiting</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="ds_severe_abdominal_pain" name="ds_severe_abdominal_pain">
                    <label class="form-check-label lang-text" data-en="Severe abdominal pain" data-mm="á€á€™á€ºá€¸á€—á€­á€¯á€€á€ºá€¡á€±á€¬á€€á€ºá€•á€­á€¯á€„á€ºá€¸á€á€½á€„á€º á€€á€¼á€¬á€™á€¼á€„á€·á€ºá€…á€½á€¬ á€”á€¬á€€á€»á€„á€ºá€™á€¾á€¯á€›á€¾á€­á€á€¼á€„á€ºá€¸" for="ds_severe_abdominal_pain">Severe abdominal pain</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="ds_fever" name="ds_fever">
                    <label class="form-check-label lang-text" data-en="Fever" data-mm="á€–á€»á€¬á€¸á€á€¼á€„á€ºá€¸" for="ds_fever">Fever</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="ds_fatigue" name="ds_fatigue">
                    <label class="form-check-label lang-text" data-en="Fatigue" data-mm="á€•á€„á€ºá€•á€”á€ºá€¸á€”á€½á€™á€ºá€¸á€”á€šá€ºá€á€¼á€„á€ºá€¸" for="ds_fatigue">Fatigue</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="ds_fast_breathing" name="ds_fast_breathing">
                    <label class="form-check-label lang-text" data-en="Fast breathing" data-mm="á€¡á€žá€€á€ºá€›á€¾á€°á€™á€¼á€”á€ºá€á€¼á€„á€ºá€¸" for="ds_fast_breathing">Fast breathing</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="ds_difficulty_breathing" name="ds_difficulty_breathing">
                    <label class="form-check-label lang-text" data-en="Difficulty in breathing" data-mm="á€¡á€žá€€á€ºá€›á€¾á€°á€›á€á€€á€ºá€á€²á€á€¼á€„á€ºá€¸" for="ds_difficulty_breathing">Difficulty in breathing</label>
                  </div>
                  
                  <h6 class="text-warning mt-3 lang-text" data-en="Swelling of face / hands" data-mm="á€™á€»á€€á€ºá€”á€¾á€¬/á€œá€€á€º/á€á€¼á€±á€™á€»á€¬á€¸ á€á€½á€„á€º á€›á€„á€ºá€žá€•á€ºá€›á€±á€¬á€„á€ºá€á€¼á€„á€ºá€¸">Swelling of face / hands</h6>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="ds_puffiness" name="ds_puffiness">
                    <label class="form-check-label lang-text" data-en="Puffiness of face, hands and leg" data-mm="á€™á€»á€€á€ºá€”á€¾á€¬áŠ á€œá€€á€ºáŠ á€á€¼á€±á€‘á€±á€¬á€€á€ºá€á€½á€„á€º á€›á€±á€¬á€„á€ºá€›á€™á€ºá€¸á€á€¼á€„á€ºá€¸" for="ds_puffiness">Puffiness of face, hands and leg</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="ds_oliguria" name="ds_oliguria">
                    <label class="form-check-label lang-text" data-en="Oliguria" data-mm="á€†á€®á€¸á€”á€Šá€ºá€¸á€á€¼á€„á€ºá€¸" for="ds_oliguria">Oliguria</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="ds_excessive_vomiting" name="ds_excessive_vomiting">
                    <label class="form-check-label lang-text" data-en="Excessive vomiting" data-mm="á€¡á€œá€½á€”á€ºá€¡á€™á€„á€ºá€¸ á€¡á€”á€ºá€á€¼á€„á€ºá€¸" for="ds_excessive_vomiting">Excessive vomiting</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="ds_abdominal_pain" name="ds_abdominal_pain">
                    <label class="form-check-label lang-text" data-en="Abdominal pain" data-mm="á€á€™á€ºá€¸á€—á€­á€¯á€€á€ºá€”á€¬á€€á€»á€„á€ºá€á€¼á€„á€ºá€¸" for="ds_abdominal_pain">Abdominal pain</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="ds_reduced_fetal_movement" name="ds_reduced_fetal_movement">
                    <label class="form-check-label lang-text" data-en="Reduced/absent fetal movement (after 20 weeks)" data-mm="á€žá€”á€¹á€“á€±á€žá€¬á€¸á€œá€¾á€¯á€•á€ºá€›á€¾á€¬á€¸á€™á€¾á€¯ á€œá€»á€±á€¬á€·á€”á€Šá€ºá€¸á€á€¼á€„á€ºá€¸/á€™á€›á€¾á€­á€á€¼á€„á€ºá€¸ (á€€á€­á€¯á€šá€ºá€á€”á€º á‚á€ á€•á€á€º á€¡á€‘á€€á€º)" for="ds_reduced_fetal_movement">Reduced/absent fetal movement (after 20 weeks)</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="form-section">
        <div class="d-flex flex-column flex-md-row gap-3 justify-content-center align-items-stretch">
          <button type="submit" class="btn btn-save flex-fill">
            <i class="fas fa-save me-2"></i><span class="lang-text" data-en="Save Visit Data" data-mm="á€•á€¼á€žá€™á€¾á€¯ á€¡á€á€»á€€á€ºá€¡á€œá€€á€º á€žá€­á€™á€ºá€¸á€†á€Šá€ºá€¸á€›á€”á€º">Save Visit Data</span>
          </button>
          <button type="button" class="btn btn-outline-primary flex-fill" onclick="referPatient()">
            <i class="fas fa-share-square me-2"></i><span class="lang-text" data-en="Refer Patient" data-mm="á€œá€°á€”á€¬ á€œá€½á€¾á€²á€•á€¼á€±á€¬á€„á€ºá€¸á€›á€”á€º">Refer Patient</span>
        </button>
        </div>
      </div>
    </form>
  </div>

  <footer class="footer">
    <div class="container">
      <p class="mb-0">
        <i class="fas fa-heart me-2"></i>
        Â© 2025 Maternal & Child Health Care System â€” Designed for clinical excellence - Powered by Jhpiego Myanmar
      </p>
    </div>
  </footer>

  <script>
    let currentUser = null;
    let currentPatient = null;
    let patientId = null;
    let visitCount = 1;
    
    // Language switching
    let currentLanguage = localStorage.getItem('appLanguage') || 'mm';

    // Language switching function
    function switchLanguage(lang) {
      currentLanguage = lang;
      localStorage.setItem('appLanguage', lang);
      
      // Update active button
      document.querySelectorAll('.language-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.lang === lang);
      });
      
      // Update all text elements with lang-text class
      document.querySelectorAll('.lang-text').forEach(el => {
        const text = el.dataset[lang] || el.dataset.en || el.textContent;
        el.textContent = text;
      });
    }

    // Get patient ID from URL
    const urlParams = new URLSearchParams(window.location.search);
    patientId = urlParams.get('patient');

    firebase.auth().onAuthStateChanged(function(user) {
      if (!user) {
        window.location.href = "login.html";
      } else {
        currentUser = user;
        loadPatientInfo();
      }
    });

    async function loadPatientInfo() {
      try {
        if (!patientId) {
          alert('Patient ID not found.');
          return;
        }

        // Load patient data
        const patientDoc = await firebase.firestore()
          .collection("patients")
          .doc(patientId)
          .get();

        if (!patientDoc.exists) {
          alert('Patient not found.');
          return;
        }

        currentPatient = patientDoc.data();
        
        // Populate patient name in header
        document.getElementById('patientNameDisplay').textContent = currentPatient.name || 'Unknown Patient';

        // Load visit count and set visit number
        await loadVisitCount();
        document.getElementById('visitNumber').value = visitCount;
        

        // Auto-calculate gestational age if LMP is available
        if (currentPatient.lmp) {
          calculateGestationalAge();
        }

        // Load existing visit data if available
        await loadExistingVisitData();

      } catch (error) {
        console.error('Error loading patient info:', error);
        alert(`Error loading patient information: ${error.message}`);
      }
    }

    async function loadVisitCount() {
      try {
        console.log('Loading visit count for patient:', patientId);
        
        const visitsSnapshot = await firebase.firestore()
          .collection('patients')
          .doc(patientId)
          .collection('antenatal_visits')
          .orderBy('visitDate', 'desc')
          .get();
        
        console.log('Found visits:', visitsSnapshot.size);
        console.log('Visit documents:', visitsSnapshot.docs.map(doc => ({ id: doc.id, data: doc.data() })));
        
        visitCount = visitsSnapshot.size + 1;
        console.log('Calculated visit count:', visitCount);
      } catch (error) {
        console.error('Error loading visit count:', error);
        visitCount = 1;
      }
    }

    async function loadExistingVisitData() {
      try {
        console.log('Loading existing visit data for patient:', patientId);
        
        // Load the most recent visit data to populate the form
        const visitsSnapshot = await firebase.firestore()
          .collection('patients')
          .doc(patientId)
          .collection('antenatal_visits')
          .orderBy('visitDate', 'desc')
          .limit(1)
          .get();
        
        console.log('Found existing visits:', visitsSnapshot.size);
        
        if (!visitsSnapshot.empty) {
          const latestVisit = visitsSnapshot.docs[0].data();
          
          // Populate form fields with latest visit data (with null checks)
          const setValue = (id, value) => {
            const el = document.getElementById(id);
            if (el && value !== undefined && value !== null) el.value = value;
          };
          
          setValue('weight', latestVisit.weight);
          setValue('height', latestVisit.height);
          setValue('bloodPressure', latestVisit.bloodPressure);
          setValue('pulseRate', latestVisit.pulseRate);
          setValue('anemiaStatus', latestVisit.anemiaStatus);
          setValue('jaundiceStatus', latestVisit.jaundiceStatus);
          setValue('breastExam', latestVisit.breastExam);
          setValue('pittingEdema', latestVisit.pittingEdema);
          setValue('tbSymptoms', latestVisit.tbSymptoms);
          setValue('coinfectionNotes', latestVisit.coinfectionNotes);
          setValue('urineTest', latestVisit.urineTest);
          setValue('gestationalAgeDisplay', latestVisit.gestationalAge);
          setValue('fundalHeight', latestVisit.fundalHeight);
          setValue('fetalHeartRate', latestVisit.fetalHeartRate);
          setValue('deworming', latestVisit.deworming);
          setValue('ironFolicAcid', latestVisit.ironFolicAcid);
          setValue('tetanusToxoid', latestVisit.tetanusToxoid);
          setValue('vitaminB1', latestVisit.vitaminB1);
          setValue('treatmentGiven', latestVisit.treatmentGiven);
          setValue('initial', latestVisit.initial);
          if (typeof latestVisit.otherVisitCount === 'number') setValue('otherVisitCount', latestVisit.otherVisitCount);
          setValue('visitNumberOther', latestVisit.visitNumberOther);
          setValue('nextVisitDate', latestVisit.nextVisitDate);
          setValue('clinicalNotes', latestVisit.clinicalNotes);
          
          // Load ANC information from latest visit
          setValue('lmp', latestVisit.lmp);
          setValue('edd', latestVisit.edd);
          
          // Load LMP status
          if (latestVisit.lmpStatus) {
            const lmpRadio = document.getElementById(latestVisit.lmpStatus === 'known' ? 'lmpKnown' : 'lmpUnknown');
            if (lmpRadio) {
              lmpRadio.checked = true;
            toggleLMPFields();
            }
          }
          
          // Load manual GA/EDD if LMP unknown
          setValue('manualGestationalAge', latestVisit.manualGestationalAge);
          setValue('manualEdd', latestVisit.manualEdd);
          
          // Load danger signs checkboxes
          if (latestVisit.dangerSigns) {
            Object.keys(latestVisit.dangerSigns).forEach(sign => {
              const checkbox = document.getElementById(`ds_${sign}`);
              if (checkbox) {
                checkbox.checked = latestVisit.dangerSigns[sign];
              }
            });
          }
          
          // Load Early ANC Visit checkbox
          const earlyAncCheckbox = document.getElementById('earlyAncVisit');
          if (earlyAncCheckbox && latestVisit.early_anc_visit !== undefined) {
            earlyAncCheckbox.checked = latestVisit.early_anc_visit;
          }
          
          if (latestVisit.pastHistoryStatus) {
            const historyRadio = document.querySelector(`input[name="pastHistoryStatus"][value="${latestVisit.pastHistoryStatus}"]`);
            if (historyRadio) {
              historyRadio.checked = true;
              togglePastHistoryNotes();
            }
          }
          setValue('pastHistoryNotes', latestVisit.pastHistoryNotes);
          toggleCoinfectionNotes();
          toggleLMPFields();
          
          // Load High Risk Assessment
          if (latestVisit.high_risk) {
            const highRiskRadio = document.querySelector(`input[name="highRisk"][value="${latestVisit.high_risk}"]`);
            if (highRiskRadio) {
              highRiskRadio.checked = true;
              toggleHighRiskDetails(); // Show/hide risk factors section
            }
          }
          
          // Load High Risk Factors checkboxes
          if (latestVisit.risk_factors && Array.isArray(latestVisit.risk_factors)) {
            latestVisit.risk_factors.forEach(riskFactor => {
              const checkbox = document.querySelector(`input[name="riskFactors"][value="${riskFactor}"]`);
              if (checkbox) {
                checkbox.checked = true;
              }
            });
          }
          
          // Load Risk Notes
          setValue('riskNotes', latestVisit.risk_notes);
          
          // Load additional fields
          setValue('temperature', latestVisit.temperature);
          setValue('temperatureUnit', latestVisit.temperatureUnit);
          setValue('bloodGroup', latestVisit.bloodGroup);
          setValue('rhesusFactor', latestVisit.rhesusFactor);
          setValue('urineProtein', latestVisit.urineProtein);
          setValue('urineSugar', latestVisit.urineSugar);
          setValue('otherFindings', latestVisit.otherFindings);
          setValue('cvs', latestVisit.cvs);
          setValue('rs', latestVisit.rs);
          setValue('cns', latestVisit.cns);
          setValue('mentalHealthStatus', latestVisit.mentalHealthStatus);
          setValue('fetalLie', latestVisit.fetalLie);
          setValue('fetalPresentation', latestVisit.fetalPresentation);
          setValue('otherMedications', latestVisit.otherMedications);
          
          // Load fetal movement radio
          if (latestVisit.fetalMovement) {
            const fetalMovementRadio = document.querySelector(`input[name="fetalMovement"][value="${latestVisit.fetalMovement}"]`);
            if (fetalMovementRadio) {
              fetalMovementRadio.checked = true;
            }
          }
        }
      } catch (error) {
        console.error('Error loading existing visit data:', error);
      }
    }

    function calculateGestationalAge() {
      if (currentPatient?.lmp) {
        const lmpDate = new Date(currentPatient.lmp);
        const today = new Date();
        const diffTime = today - lmpDate;
        const diffWeeks = Math.floor(diffTime / (1000 * 60 * 60 * 24 * 7));
        const diffDays = Math.floor((diffTime % (1000 * 60 * 60 * 24 * 7)) / (1000 * 60 * 60 * 24));
        const gestationalAge = diffWeeks + (diffDays / 7);
        const displayGA = document.getElementById('gestationalAgeDisplay');
        if (displayGA) {
          displayGA.value = gestationalAge.toFixed(1);
        }
      }
    }

    function updateGestationalAge() {
      const manualGAInput = document.getElementById('gestationalAgeManual');
      const displayGA = document.getElementById('gestationalAgeDisplay');
      
      if (manualGAInput?.value && displayGA) {
        displayGA.value = manualGAInput.value;
      } else {
        // Recalculate from LMP if available
        if (currentPatient?.lmp) {
          calculateGestationalAge();
        }
      }
    }

    function calculateGestationalAgeAndEDD() {
      const lmpInput = document.getElementById('lmp');
      const eddInput = document.getElementById('edd');
      
      if (lmpInput?.value && eddInput) {
        const lmpDate = new Date(lmpInput.value);
        
        // Calculate EDD (LMP + 280 days)
        const eddDate = new Date(lmpDate.getTime() + (280 * 24 * 60 * 60 * 1000));
        eddInput.value = eddDate.toISOString().split('T')[0];
        
        // Update gestational age display
        calculateGestationalAgeFromLMP(lmpInput.value);
      }
    }

    function calculateGestationalAgeFromLMP(lmpValue) {
      if (lmpValue) {
        const lmpDate = new Date(lmpValue);
        const today = new Date();
        const diffTime = today - lmpDate;
        const diffWeeks = Math.floor(diffTime / (1000 * 60 * 60 * 24 * 7));
        const diffDays = Math.floor((diffTime % (1000 * 60 * 60 * 24 * 7)) / (1000 * 60 * 60 * 24));
        const gestationalAge = diffWeeks + (diffDays / 7);
        const displayGA = document.getElementById('gestationalAgeDisplay');
        if (displayGA) {
          displayGA.value = gestationalAge.toFixed(1);
        }
      }
    }

    function calculateEDDFromGA() {
      const gaInput = document.getElementById('manualGestationalAge');
      const eddInput = document.getElementById('manualEdd');
      
      if (gaInput.value) {
        const today = new Date();
        const weeksFromNow = 40 - parseFloat(gaInput.value); // Assuming 40 weeks full term
        const eddDate = new Date(today.getTime() + (weeksFromNow * 7 * 24 * 60 * 60 * 1000));
        eddInput.value = eddDate.toISOString().split('T')[0];
      }
    }

    function toggleLMPFields() {
      const lmpKnown = document.getElementById('lmpKnown').checked;
      const manualSection = document.getElementById('manualGAEDDSection');
      const lmpKnownGroups = document.querySelectorAll('.history-known-only');
      const autoGASection = document.getElementById('autoGASection');
      const lmpInput = document.getElementById('lmp');
      const eddInput = document.getElementById('edd');
      const manualGAInput = document.getElementById('manualGestationalAge');
      const manualEddInput = document.getElementById('manualEdd');
    
      if (lmpKnown) {
        manualSection.style.display = 'none';
        autoGASection.style.display = 'flex';
        lmpKnownGroups.forEach(el => el.style.display = '');
        lmpInput.disabled = false;
        manualGAInput.value = '';
        manualEddInput.value = '';
        calculateGestationalAgeAndEDD();
      } else {
        manualSection.style.display = 'flex';
        autoGASection.style.display = 'none';
        lmpKnownGroups.forEach(el => el.style.display = 'none');
        lmpInput.disabled = true;
        lmpInput.value = '';
        eddInput.value = '';
      }
    }

    function togglePastHistoryNotes() {
      const riskSelected = document.getElementById('pastHistoryStatusRisk').checked;
      const notesGroup = document.getElementById('pastHistoryNotesGroup');
      if (notesGroup) {
        notesGroup.style.display = riskSelected ? '' : 'none';
        if (!riskSelected) {
          document.getElementById('pastHistoryNotes').value = '';
        }
      }
    }

    function toggleCoinfectionNotes() {
      const select = document.getElementById('tbSymptoms');
      const notesGroup = document.getElementById('coinfectionNotesGroup');
      if (!select || !notesGroup) return;
      if (select.value === 'Yes') {
        notesGroup.style.display = '';
      } else {
        notesGroup.style.display = 'none';
        document.getElementById('coinfectionNotes').value = '';
      }
    }

    function setToday(fieldId) {
      const field = document.getElementById(fieldId);
      if (field) {
      const today = new Date().toISOString().split('T')[0];
        field.value = today;
      }
    }
    
    // Toggle high risk details
    function toggleHighRiskDetails() {
      const highRisk = document.querySelector('input[name="highRisk"]:checked');
      const highRiskDetails = document.getElementById('highRiskDetails');
      
      if (highRisk && highRisk.value === 'yes') {
        highRiskDetails.style.display = 'block';
      } else {
        highRiskDetails.style.display = 'none';
      }
    }
    
    // Initialize high risk toggle on page load
    document.addEventListener('DOMContentLoaded', function() {
      // Add event listeners to high risk radios
      document.querySelectorAll('input[name="highRisk"]').forEach(radio => {
        radio.addEventListener('change', toggleHighRiskDetails);
      });

      document.querySelectorAll('input[name="pastHistoryStatus"]').forEach(radio => {
        radio.addEventListener('change', togglePastHistoryNotes);
      });

      const tbSelect = document.getElementById('tbSymptoms');
      if (tbSelect) {
        tbSelect.addEventListener('change', toggleCoinfectionNotes);
      }

      toggleLMPFields();
      togglePastHistoryNotes();
      toggleCoinfectionNotes();
    });

    function setNextMonth(fieldId) {
      const field = document.getElementById(fieldId);
      if (field) {
      const today = new Date();
      const nextMonth = new Date(today.getTime() + (28 * 24 * 60 * 60 * 1000)); // 4 weeks
        field.value = nextMonth.toISOString().split('T')[0];
      }
    }

    function referPatient() {
      if (!patientId) {
        window.location.href = 'transfer.html';
        return;
      }
      window.location.href = `transfer.html?patient=${encodeURIComponent(patientId)}`;
    }

    function fillCurrentUser(fieldId) {
      if (currentUser) {
        const field = document.getElementById(fieldId);
        if (field) {
          field.value = currentUser.email || 'Current User';
        }
      }
    }

    function checkDangerSignsPresent() {
      // Check all danger sign checkboxes
      const dangerSigns = [
        'ds_vaginal_bleeding', 'ds_convulsions', 'ds_loss_consciousness', 'ds_severe_headache',
        'ds_blurred_vision', 'ds_vomiting', 'ds_severe_abdominal_pain', 'ds_fever', 'ds_fatigue',
        'ds_fast_breathing', 'ds_difficulty_breathing', 'ds_puffiness', 'ds_oliguria', 
        'ds_excessive_vomiting', 'ds_abdominal_pain', 'ds_reduced_fetal_movement',
        'ds_no_labour_pain', 'ds_no_delivery', 'ds_postpartum_hemorrhage', 'ds_no_placenta',
        'ds_very_small_baby', 'ds_difficulty_breathing_baby'
      ];
      
      for (let checkboxId of dangerSigns) {
        if (document.getElementById(checkboxId) && document.getElementById(checkboxId).checked) {
          return 'Yes';
        }
      }
      return 'No';
    }


    async function saveVisitData(event) {
      event.preventDefault();
      
      // Prevent double submission
      const submitButton = event.target.querySelector('button[type="submit"]');
      if (submitButton) {
        submitButton.disabled = true;
        submitButton.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Saving...';
      }
      
      try {
        // Helper function to safely get element value
        const getValue = (id) => {
          const el = document.getElementById(id);
          return el ? el.value : '';
        };
        
        // Helper function to safely get number value
        const getNumber = (id) => {
          const el = document.getElementById(id);
          if (!el || !el.value || el.value.trim() === '') return null;
          const num = parseFloat(el.value);
          return isNaN(num) ? null : num;
        };
        
        // Helper function to safely get integer value
        const getInt = (id) => {
          const el = document.getElementById(id);
          if (!el || !el.value || el.value.trim() === '') return null;
          const num = parseInt(el.value);
          return isNaN(num) ? null : num;
        };
        
        // Helper function to safely get checkbox state
        const getChecked = (id) => {
          const el = document.getElementById(id);
          return el ? (el.checked || false) : false;
        };
        
        // Collect all form data with null-safe access
        const visitData = {
          visitNumber: visitCount, // Use the calculated visit count instead of form input
          visitNumberOther: getValue('visitNumberOther'),
          visitDate: getValue('visitDate'),
          timestamp: firebase.firestore.FieldValue.serverTimestamp(),
          healthFacility: currentPatient?.township || 'Unknown Facility',
          totalAncVisits: visitCount - 1, // Previous visits count
          
          // Main table data
          weight: getNumber('weight'),
          height: getValue('height'), // Height is text (ft, inches)
          bloodPressure: getValue('bloodPressure'),
          pulseRate: getInt('pulseRate'),
          anemiaStatus: getValue('anemiaStatus'),
          pittingEdema: getValue('pittingEdema'),
          gestationalAge: getNumber('gestationalAgeDisplay'),
          fundalHeight: getNumber('fundalHeight'),
          fetalPresentation: getValue('fetalPresentation'),
          fetalHeartRate: getInt('fetalHeartRate'),
          deworming: getValue('deworming'),
          tbSymptoms: getValue('tbSymptoms'),
          coinfectionNotes: getValue('coinfectionNotes'),
          initial: getValue('initial'),
          otherVisitCount: getInt('otherVisitCount') || 0,
          
          // Second table data
          ironFolicAcid: getValue('ironFolicAcid'),
          tetanusToxoid: getValue('tetanusToxoid'),
          vitaminB1: getValue('vitaminB1'),
          nextVisitDate: getValue('nextVisitDate') || null,
          
          // Danger signs - determine if any are present
          dangerSignsPresent: checkDangerSignsPresent(),
          dangerSigns: {
            vaginal_bleeding: getChecked('ds_vaginal_bleeding'),
            convulsions: getChecked('ds_convulsions'),
            loss_consciousness: getChecked('ds_loss_consciousness'),
            severe_headache: getChecked('ds_severe_headache'),
            blurred_vision: getChecked('ds_blurred_vision'),
            vomiting: getChecked('ds_vomiting'),
            severe_abdominal_pain: getChecked('ds_severe_abdominal_pain'),
            fever: getChecked('ds_fever'),
            fatigue: getChecked('ds_fatigue'),
            fast_breathing: getChecked('ds_fast_breathing'),
            difficulty_breathing: getChecked('ds_difficulty_breathing'),
            puffiness: getChecked('ds_puffiness'),
            oliguria: getChecked('ds_oliguria'),
            excessive_vomiting: getChecked('ds_excessive_vomiting'),
            abdominal_pain: getChecked('ds_abdominal_pain'),
            reduced_fetal_movement: getChecked('ds_reduced_fetal_movement')
          },
          
          clinicalNotes: getValue('clinicalNotes'),
          
          // ANC Information
          lmp: getValue('lmp') || null,
          edd: getValue('edd') || null,
          lmpStatus: (() => {
            const checked = document.querySelector('input[name="lmpStatus"]:checked');
            return checked ? checked.value : 'known';
          })(),
          manualGestationalAge: getNumber('manualGestationalAge'),
          manualEdd: getValue('manualEdd') || null,
          
          // Early ANC Visit
          early_anc_visit: getChecked('earlyAncVisit'),
          
          // Past history
          pastHistoryStatus: (() => {
            const checked = document.querySelector('input[name="pastHistoryStatus"]:checked');
            return checked ? checked.value : 'nad';
          })(),
          pastHistoryNotes: getValue('pastHistoryNotes'),
          
          // High risk pregnancy assessment
          high_risk: (() => {
            const checked = document.querySelector('input[name="highRisk"]:checked');
            return checked ? checked.value : 'no';
          })(),
          risk_factors: Array.from(document.querySelectorAll('input[name="riskFactors"]:checked')).map(cb => cb.value),
          risk_notes: getValue('riskNotes') || null,
          
          // Additional fields
          temperature: getValue('temperature'),
          temperatureUnit: getValue('temperatureUnit') || 'C',
          bloodGroup: getValue('bloodGroup'),
          rhesusFactor: getValue('rhesusFactor'),
          urineProtein: getValue('urineProtein'),
          urineSugar: getValue('urineSugar'),
          otherFindings: getValue('otherFindings'),
          cvs: getValue('cvs'),
          rs: getValue('rs'),
          cns: getValue('cns'),
          mentalHealthStatus: getValue('mentalHealthStatus'),
          fetalLie: getValue('fetalLie'),
          fetalMovement: (() => {
            const checked = document.querySelector('input[name="fetalMovement"]:checked');
            return checked ? checked.value : '';
          })(),
          otherMedications: getValue('otherMedications'),
          
          patientId: patientId,
          recordedBy: currentUser?.uid || ''
        };

        console.log('Saving visit data:', visitData);
        
        // Save visit data to Firestore
        const visitRef = await firebase.firestore()
          .collection('patients')
          .doc(patientId)
          .collection('antenatal_visits')
          .add(visitData);

        console.log('Visit saved with ID:', visitRef.id);

        // Update patient's last antenatal visit
        await firebase.firestore()
          .collection('patients')
          .doc(patientId)
          .update({
            lastAntenatalVisit: firebase.firestore.FieldValue.serverTimestamp(),
            lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
          });

        console.log('Patient record updated');

        // Update patient status to Antenatal Care (if first visit)
        const statusUpdated = await StatusManager.checkAndUpdateToAntenatalCare(patientId);
        if (statusUpdated) {
          console.log('âœ… Patient status updated to Antenatal Care');
        }

        // Refresh the visit count to ensure accuracy
        await loadVisitCount();
        console.log('Visit count refreshed:', visitCount);

        alert('Visit data saved successfully!');
        console.log('Visit data saved:', visitRef.id);
        
        // Redirect to antenatal care main page
        window.location.href = 'antenatal-care.html';

      } catch (error) {
        console.error('Error saving visit data:', error);
        alert(`Error saving visit data: ${error.message}`);
        
        // Reset button state on error
        if (submitButton) {
          submitButton.disabled = false;
          submitButton.innerHTML = '<i class="fas fa-save me-2"></i><span class="lang-text" data-en="Save Visit Data" data-mm="á€¼á€žá€™á€¾á€¯ á€¡á€á€»á€€á€ºá€¡á€œá€€á€º á€žá€­á€™á€ºá€¸á€†á€Šá€ºá€¸á€›á€”á€º">Save Visit Data</span>';
        }
      }
    }

    function generateAntenatalReport() {
      window.open(`antenatal-report.html?patient=${patientId}`, '_blank');
    }

    function showVisitHistory() {
      // Redirect to antenatal care page to show history
      window.location.href = `antenatal-care.html`;
    }

    // Set today's date on page load
    window.addEventListener('load', function() {
      setToday('visitDate');
      
      // Initialize language switcher
      document.querySelectorAll('.language-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          switchLanguage(this.dataset.lang);
        });
      });
      
      // Set initial language
      switchLanguage(currentLanguage);
    });
  </script>
</body>
</html>


