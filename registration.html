<!DOCTYPE html>
<html>
<head>
  <title>User Registration</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/style.css" />
</head>
<body class="container my-5">
  <div class="text-center mb-4">
    <h2>👩‍⚕️ Register New Account</h2>
    <p class="text-muted">Join the Labour Care Guide system</p>
  </div>
  <form id="registerForm" class="mb-3">
    <div class="mb-3">
      <label for="name" class="form-label">Full Name</label>
      <input name="name" id="name" class="form-control" placeholder="Enter your full name" required>
    </div>
    <div class="mb-3">
      <label for="role" class="form-label">Professional Role</label>
      <select name="role" id="role" class="form-control" required>
        <option value="">Select your professional role</option>
        <option value="Midwife">👩‍⚕️ Midwife</option>
        <option value="TMO">🏥 TMO (Township Medical Officer)</option>
      </select>
    </div>
    <div class="mb-3">
      <label for="regionSelect" class="form-label">Region (State/Division)</label>
      <select name="region" id="regionSelect" class="form-control" required onchange="updateTownships()">
        <option value="">Select your region first</option>
        <option value="Yangon">🏙️ Yangon Region</option>
        <option value="Mandalay">🏛️ Mandalay Region</option>
        <option value="Bago">🏘️ Bago Region</option>
        <option value="Ayeyarwady">🌊 Ayeyarwady Region</option>
        <option value="Sagaing">🏔️ Sagaing Region</option>
        <option value="Magway">🏜️ Magway Region</option>
        <option value="Tanintharyi">🏖️ Tanintharyi Region</option>
        <option value="Kachin">🏔️ Kachin State</option>
        <option value="Kayah">🏞️ Kayah State</option>
        <option value="Kayin">🌲 Kayin State</option>
        <option value="Chin">⛰️ Chin State</option>
        <option value="Mon">🏺 Mon State</option>
        <option value="Rakhine">🌊 Rakhine State</option>
        <option value="Shan">🏔️ Shan State</option>
      </select>
    </div>
    <div class="mb-3">
      <label for="townshipSelect" class="form-label">Township</label>
      <select name="township" id="townshipSelect" class="form-control" required disabled>
        <option value="">Please select a region first</option>
      </select>
      <div class="form-text">Township options will appear after selecting a region</div>
    </div>
    <div class="mb-3">
      <label for="clinic" class="form-label">Clinic/Hospital Name</label>
      <input name="clinic" id="clinic" class="form-control" placeholder="Enter clinic or hospital name (optional)">
    </div>
    <div class="mb-3">
      <label for="phone" class="form-label">Phone Number</label>
      <input name="phone" id="phone" class="form-control" placeholder="Enter your phone number" required>
    </div>
    <div class="mb-3">
      <label for="email" class="form-label">Email Address</label>
      <input name="email" id="email" type="email" class="form-control" placeholder="Enter your email address (optional)">
    </div>
    <div class="mb-3">
      <label for="password" class="form-label">Password</label>
      <input name="password" id="password" type="password" class="form-control" placeholder="Create a strong password" required>
    </div>
    <div class="mb-3">
      <label for="confirm" class="form-label">Confirm Password</label>
      <input name="confirm" id="confirm" type="password" class="form-control" placeholder="Confirm your password" required>
    </div>
    <button type="submit" class="btn btn-primary w-100 btn-lg">
      <i class="fas fa-user-plus"></i> Create Account
    </button>
  </form>
  
  <div id="registerMsg"></div>
  
  <div class="text-center mt-4">
    <p class="text-muted">Already have an account?</p>
    <a href="login.html" class="btn btn-outline-secondary">
      <i class="fas fa-sign-in-alt"></i> Back to Login
    </a>
  </div>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="js/firebase.js"></script>
  <script>
    // Myanmar administrative data
    const myanmarRegions = {
      'Yangon': [
        'Hlaing', 'Kamayut', 'Sanchaung', 'Bahan', 'Dagon', 'Kyauktada', 'Pabedan', 'Lanmadaw', 'Latha', 'Pazundaung',
        'Botataung', 'Mingala Taungnyunt', 'Tamwe', 'Yankin', 'Thingangyun', 'South Okkalapa', 'North Okkalapa', 'East Dagon',
        'North Dagon', 'Dagon Seikkan', 'Dawbon', 'Seikkyi Kanaungto', 'Insein', 'Hmawbi', 'Hlegu', 'Taikkyi', 'Shwepyitha',
        'Kawmhu', 'Kayan', 'Twante', 'Kungyangon', 'Thanlyin', 'Kyauktan', 'Thongwa', 'Kawhmu', 'Cocokyun', 'Dala'
      ],
      'Mandalay': [
        'Amarapura', 'Aungmyethazan', 'Chanayethazan', 'Chanmyathazi', 'Mahaaungmye', 'Patheingyi', 'Pyigyidagun',
        'Mahlaing', 'Meiktila', 'Thazi', 'Wundwin', 'Myingyan', 'Taungtha', 'Natogyi', 'Kyaukpadaung', 'Nyaung-U',
        'Kyaukse', 'Myittha', 'Sintgaing', 'Tada-U', 'Myingyan', 'Taungtha', 'Natogyi', 'Kyaukpadaung', 'Nyaung-U'
      ],
      'Bago': [
        'Bago', 'Thanatpin', 'Kawa', 'Waw', 'Nyaunglebin', 'Kayan', 'Daik-U', 'Shwegyin', 'Kyauktaga', 'Pyu',
        'Oktwin', 'Htantabin', 'Monyo', 'Gyobingauk', 'Letpadan', 'Minhla', 'Okpho', 'Zigon', 'Nattalin', 'Kyaikto',
        'Bilin', 'Kyaikmaraw', 'Chaungzon', 'Mudon', 'Thanbyuzayat', 'Ye', 'Kawareik', 'Kawkareik', 'Kyainseikgyi'
      ],
      'Ayeyarwady': [
        'Pathein', 'Kangyidaunk', 'Thabaung', 'Ngapudaw', 'Labutta', 'Mawlamyinegyun', 'Kyaiklat', 'Pyapon',
        'Bogale', 'Dedaye', 'Kyaunggon', 'Kyonpyaw', 'Ingapu', 'Myaungmya', 'Einme', 'Wakema', 'Myaungmya',
        'Kangyidaunk', 'Thabaung', 'Ngapudaw', 'Labutta', 'Mawlamyinegyun', 'Kyaiklat', 'Pyapon', 'Bogale'
      ],
      'Sagaing': [
        'Sagaing', 'Myinmu', 'Khin-U', 'Wuntho', 'Kale', 'Kalewa', 'Mingin', 'Monywa', 'Butalin', 'Chaung-U',
        'Ayadaw', 'Taze', 'Kawlin', 'Wuntho', 'Pinlebu', 'Mawlaik', 'Paungbyin', 'Homalin', 'Laychay', 'Hkamti'
      ],
      'Magway': [
        'Magway', 'Yenangyaung', 'Chauk', 'Taungdwingyi', 'Myothit', 'Natmauk', 'Minbu', 'Salin', 'Sidoktaya',
        'Pwintbyu', 'Ngape', 'Seikpyu', 'Gangaw', 'Tilin', 'Saw', 'Htilin', 'Kyaukhtu', 'Chauk', 'Yenangyaung'
      ],
      'Tanintharyi': [
        'Dawei', 'Launglon', 'Thayetchaung', 'Yebyu', 'Myeik', 'Kyunsu', 'Palaw', 'Tanintharyi', 'Kawthoung',
        'Bokpyin', 'Pyigyimandaing', 'Kawthoung', 'Bokpyin', 'Pyigyimandaing', 'Dawei', 'Launglon', 'Thayetchaung'
      ],
      'Kachin': [
        'Myitkyina', 'Waingmaw', 'Injangyang', 'Tanai', 'Chipwi', 'Hsawlaw', 'Myitkyina', 'Waingmaw', 'Injangyang',
        'Tanai', 'Chipwi', 'Hsawlaw', 'Putao', 'Machanbaw', 'Khaunglanphu', 'Nogmung', 'Sumprabum', 'Hpakant'
      ],
      'Kayah': [
        'Loikaw', 'Demoso', 'Hpruso', 'Shadaw', 'Bawlakhe', 'Hpasawng', 'Mese', 'Ywathit', 'Loikaw', 'Demoso'
      ],
      'Kayin': [
        'Hpa-an', 'Hlaingbwe', 'Hpapun', 'Thandaunggyi', 'Kawkareik', 'Kyainseikgyi', 'Myawaddy', 'Kawkareik',
        'Kyainseikgyi', 'Hpa-an', 'Hlaingbwe', 'Hpapun', 'Thandaunggyi', 'Myawaddy', 'Kawkareik', 'Kyainseikgyi'
      ],
      'Chin': [
        'Hakha', 'Falam', 'Tedim', 'Tonzang', 'Matupi', 'Mindat', 'Kanpetlet', 'Paletwa', 'Hakha', 'Falam',
        'Tedim', 'Tonzang', 'Matupi', 'Mindat', 'Kanpetlet', 'Paletwa', 'Hakha', 'Falam', 'Tedim', 'Tonzang'
      ],
      'Mon': [
        'Mawlamyine', 'Chaungzon', 'Thanbyuzayat', 'Mudon', 'Ye', 'Kyaikmaraw', 'Bilin', 'Kyaikto', 'Kawkareik',
        'Kyainseikgyi', 'Mawlamyine', 'Chaungzon', 'Thanbyuzayat', 'Mudon', 'Ye', 'Kyaikmaraw', 'Bilin', 'Kyaikto'
      ],
      'Rakhine': [
        'Sittwe', 'Ponnagyun', 'Pauktaw', 'Rathedaung', 'Kyauktaw', 'Mrauk-U', 'Minbya', 'Myebon', 'Pauktaw',
        'Rathedaung', 'Kyauktaw', 'Mrauk-U', 'Minbya', 'Myebon', 'Sittwe', 'Ponnagyun', 'Pauktaw', 'Rathedaung'
      ],
      'Shan': [
        'Taunggyi', 'Nyaungshwe', 'Hopong', 'Hsihseng', 'Kalaw', 'Pindaya', 'Ywangan', 'Lawksawk', 'Pekon',
        'Loilen', 'Laihka', 'Mongnai', 'Mongpan', 'Mongkaing', 'Monghsu', 'Mongkung', 'Mongnai', 'Mongpan'
      ]
    };

    // Function to update townships based on selected region
    function updateTownships() {
      const regionSelect = document.getElementById('regionSelect');
      const townshipSelect = document.getElementById('townshipSelect');
      const selectedRegion = regionSelect.value;
      
      // Clear and disable township select
      townshipSelect.innerHTML = '<option value="">Select Township</option>';
      townshipSelect.disabled = true;
      
      if (selectedRegion && myanmarRegions[selectedRegion]) {
        // Enable township select and populate options
        townshipSelect.disabled = false;
        
        // Add township options
        myanmarRegions[selectedRegion].forEach(township => {
          const option = document.createElement('option');
          option.value = township;
          option.textContent = township;
          townshipSelect.appendChild(option);
        });
      }
    }

    const form = document.getElementById("registerForm");
    form.onsubmit = async (e) => {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(form));
      
      // Validate required fields
      if (!data.region || !data.township) {
        document.getElementById("registerMsg").innerHTML = '<div class="alert alert-danger">Please select both region and township.</div>';
        return;
      }
      
      if (data.password !== data.confirm) {
        document.getElementById("registerMsg").innerHTML = '<div class="alert alert-danger">Passwords do not match.</div>';
        return;
      }
      try {
        // On registration form submit
        const cred = await firebase.auth().createUserWithEmailAndPassword(data.email, data.password);
        await db.collection("users").doc(cred.user.uid).set({
          name: data.name,
          role: data.role,
          region: data.region,
          township: data.township,
          clinic: data.clinic || "",
          phone: data.phone,
          email: data.email,
          status: 'pending', // Changed from 'approved' to 'status' for consistency
          createdAt: new Date().toISOString()
        });
        await firebase.auth().signOut();
        window.location.href = "registration-success.html";
      } catch (err) {
        document.getElementById("registerMsg").innerHTML = `<div class="alert alert-danger">${err.message}</div>`;
      }
    };
  </script>
</body>
</html>