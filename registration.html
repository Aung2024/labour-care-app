<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#10b981">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>Registration - Maternal & Child Health Care System</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  
  <style>
    :root {
      --primary-color: #10b981;
      --secondary-color: #059669;
      --accent-color: #34d399;
      --text-primary: #1f2937;
      --text-secondary: #6b7280;
      --background-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --card-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      --card-hover-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--background-gradient);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      position: relative;
      overflow-x: hidden;
    }

    /* Animated background elements */
    body::before {
      content: '';
      position: fixed;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(16, 185, 129, 0.1) 0%, transparent 50%);
      animation: float 20s ease-in-out infinite;
      z-index: 0;
    }

    body::after {
      content: '';
      position: fixed;
      top: -30%;
      right: -30%;
      width: 160%;
      height: 160%;
      background: radial-gradient(circle, rgba(52, 211, 153, 0.08) 0%, transparent 50%);
      animation: float 25s ease-in-out infinite reverse;
      z-index: 0;
    }

    @keyframes float {
      0%, 100% { transform: translate(0, 0) rotate(0deg); }
      50% { transform: translate(-20px, -20px) rotate(180deg); }
    }

    /* Main container */
    .registration-container {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem 1rem;
      position: relative;
      z-index: 1;
    }

    /* Registration card */
    .registration-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 24px;
      padding: 3rem 2.5rem;
      box-shadow: var(--card-shadow);
      border: 1px solid rgba(255, 255, 255, 0.2);
      width: 100%;
      max-width: 500px;
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .registration-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--card-hover-shadow);
    }

    /* Brand section */
    .brand {
      text-align: center;
      margin-bottom: 2.5rem;
    }

    .brand-icon {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1.5rem;
      box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
      animation: pulse 2s ease-in-out infinite;
    }

    .brand-icon i {
      font-size: 2.5rem;
      color: white;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .brand h1 {
      font-size: 2rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .brand p {
      color: var(--text-secondary);
      font-size: 1rem;
      font-weight: 400;
    }

    /* Form styling */
    .form-group {
      margin-bottom: 1.5rem;
      position: relative;
    }

    .form-label {
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .form-label i {
      color: var(--primary-color);
      width: 16px;
    }

    .form-control {
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      padding: 1rem 1.25rem;
      font-size: 1rem;
      font-weight: 400;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.8);
    }

    .form-control:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1);
      background: white;
    }

    .form-control:disabled {
      background: rgba(243, 244, 246, 0.8);
      color: #6b7280;
      cursor: not-allowed;
    }

    .form-control::placeholder {
      color: #9ca3af;
      font-weight: 400;
    }

    .form-text {
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin-top: 0.5rem;
      font-style: italic;
    }

    /* Buttons */
    .btn {
      border-radius: 12px;
      padding: 1rem 1.5rem;
      font-weight: 600;
      font-size: 1rem;
      transition: all 0.3s ease;
      border: none;
      position: relative;
      overflow: hidden;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, var(--secondary-color), #047857);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
      color: white;
    }

    .btn-primary:active {
      transform: translateY(0);
    }

    .btn-outline-secondary {
      border: 2px solid #d1d5db;
      color: var(--text-secondary);
      background: transparent;
    }

    .btn-outline-secondary:hover {
      background: rgba(243, 244, 246, 0.8);
      border-color: var(--primary-color);
      color: var(--primary-color);
    }

    /* Message styling */
    #registerMsg {
      margin-top: 1.5rem;
      padding: 1rem;
      border-radius: 12px;
      font-weight: 500;
      text-align: center;
    }

    .alert {
      border: none;
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1rem;
    }

    .alert-warning {
      background: rgba(251, 191, 36, 0.1);
      color: #92400e;
      border-left: 4px solid #f59e0b;
    }

    .alert-success {
      background: rgba(16, 185, 129, 0.1);
      color: #047857;
      border-left: 4px solid var(--primary-color);
    }

    .alert-danger {
      background: rgba(220, 38, 38, 0.1);
      color: #991b1b;
      border-left: 4px solid #dc2626;
    }

    .text-success {
      color: var(--primary-color) !important;
    }

    .text-danger {
      color: #dc2626 !important;
    }

    .text-warning {
      color: #f59e0b !important;
    }

    /* Footer */
    .footer {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      color: var(--text-secondary);
      text-align: center;
      padding: 2rem 1rem;
      border-top: 1px solid rgba(255, 255, 255, 0.2);
      position: relative;
      z-index: 1;
      margin-top: auto;
    }

    .footer p {
      margin: 0;
      font-size: 0.9rem;
      font-weight: 400;
      line-height: 1.5;
    }

    /* Medium screens (tablets, small laptops) */
    @media (min-width: 769px) and (max-width: 1024px) {
      .registration-container {
        padding: 2rem 1.5rem;
      }

      .registration-card {
        max-width: 600px;
        padding: 2.5rem 2rem;
        margin: 0 auto;
      }

      .brand h1 {
        font-size: 1.9rem;
      }

      .brand-icon {
        width: 75px;
        height: 75px;
      }

      .brand-icon i {
        font-size: 2.25rem;
      }

      .form-control {
        padding: 0.95rem 1.15rem;
      }

      .form-section {
        margin-bottom: 1.75rem;
      }

      .section-title {
        font-size: 1.2rem;
      }
    }

    /* Mobile responsiveness */
    @media (max-width: 768px) {
      .registration-container {
        padding: 1rem 0.5rem;
      }

      .registration-card {
        padding: 2rem 1.5rem;
        margin: 1rem;
        border-radius: 20px;
      }

      .brand h1 {
        font-size: 1.75rem;
      }

      .brand-icon {
        width: 70px;
        height: 70px;
      }

      .brand-icon i {
        font-size: 2rem;
      }

      .form-control {
        padding: 0.875rem 1rem;
        font-size: 0.95rem;
      }

      .btn {
        padding: 0.875rem 1.25rem;
        font-size: 0.95rem;
      }

      .footer {
        padding: 1.5rem 1rem;
      }

      .footer p {
        font-size: 0.85rem;
      }
    }

    /* Loading animation */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Form sections */
    .form-section {
      margin-bottom: 2rem;
    }

    .section-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .section-title i {
      color: var(--primary-color);
    }

    /* Role selection styling */
    .role-option {
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 0.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.8);
    }

    .role-option:hover {
      border-color: var(--primary-color);
      background: rgba(16, 185, 129, 0.05);
    }

    .role-option.selected {
      border-color: var(--primary-color);
      background: rgba(16, 185, 129, 0.1);
    }

    .role-option input[type="radio"] {
      margin-right: 0.75rem;
    }

    .role-option label {
      margin: 0;
      cursor: pointer;
      font-weight: 500;
      display: flex;
      align-items: center;
    }
  </style>
  
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="js/firebase.js"></script>
</head>
<body>
  <div class="registration-container">
    <div class="registration-card">
      <!-- Brand Section -->
      <div class="brand">
        <div class="brand-icon">
          <i class="fas fa-user-plus"></i>
        </div>
        <h1>Join Our Healthcare Team</h1>
        <p>Create your professional account to access the system</p>
  </div>

      <!-- Registration Form -->
      <form id="registerForm">
        <!-- Personal Information Section -->
        <div class="form-section">
          <h5 class="section-title">
            <i class="fas fa-user"></i> Personal Information
          </h5>
          
          <div class="form-group">
            <label for="name" class="form-label">
              <i class="fas fa-id-card"></i> Full Name
            </label>
      <input name="name" id="name" class="form-control" placeholder="Enter your full name" required>
    </div>

          <div class="form-group">
            <label for="phone" class="form-label">
              <i class="fas fa-phone"></i> Phone Number
            </label>
            <input name="phone" id="phone" class="form-control" placeholder="Enter your phone number" required>
          </div>

          <div class="form-group">
            <label for="email" class="form-label">
              <i class="fas fa-envelope"></i> Email Address
            </label>
            <input name="email" id="email" type="email" class="form-control" placeholder="Enter your email address">
            <div class="form-text">Email is optional but recommended for account recovery</div>
          </div>
        </div>

        <!-- Professional Information Section -->
        <div class="form-section">
          <h5 class="section-title">
            <i class="fas fa-briefcase-medical"></i> Professional Information
          </h5>
          
          <div class="form-group">
            <label class="form-label">
              <i class="fas fa-user-tag"></i> Professional Role
            </label>
            <div class="role-option">
              <input type="radio" name="role" id="role-midwife" value="Midwife" required>
              <label for="role-midwife">
                <i class="fas fa-user-nurse me-2"></i>Midwife
              </label>
            </div>
            <div class="role-option">
              <input type="radio" name="role" id="role-tmo" value="TMO" required>
              <label for="role-tmo">
                <i class="fas fa-user-md me-2"></i>TMO (Township Medical Officer)
              </label>
            </div>
            <div class="role-option">
              <input type="radio" name="role" id="role-superadmin" value="Superadmin" required>
              <label for="role-superadmin">
                <i class="fas fa-user-shield me-2"></i>Superadmin
              </label>
            </div>
    </div>

          <div class="form-group">
            <label for="regionSelect" class="form-label">
              <i class="fas fa-map-marker-alt"></i> Region (State/Division)
            </label>
      <select name="region" id="regionSelect" class="form-control" required onchange="updateTownships()">
        <option value="">Select your region first</option>
              <option value="Yangon Region">Yangon Region</option>
              <option value="Mandalay Region">Mandalay Region</option>
              <option value="Bago Region (East)">Bago Region (East)</option>
              <option value="Bago Region (West)">Bago Region (West)</option>
              <option value="Ayeyarwady Region">Ayeyarwady Region</option>
              <option value="Sagaing Region">Sagaing Region</option>
              <option value="Magway Region">Magway Region</option>
              <option value="Tanintharyi Region">Tanintharyi Region</option>
              <option value="Kachin State">Kachin State</option>
              <option value="Kayah State">Kayah State</option>
              <option value="Kayin State">Kayin State</option>
              <option value="Chin State">Chin State</option>
              <option value="Mon State">Mon State</option>
              <option value="Rakhine State">Rakhine State</option>
              <option value="Shan State (South)">Shan State (South)</option>
              <option value="Shan State (North)">Shan State (North)</option>
              <option value="Shan State (East)">Shan State (East)</option>
              <option value="Nay Pyi Taw">Nay Pyi Taw</option>
      </select>
    </div>

          <div class="form-group">
            <label for="townshipSelect" class="form-label">
              <i class="fas fa-building"></i> Township
            </label>
      <select name="township" id="townshipSelect" class="form-control" required disabled>
        <option value="">Please select a region first</option>
      </select>
      <div class="form-text">Township options will appear after selecting a region</div>
    </div>

          <div class="form-group">
            <label for="facility" class="form-label">
              <i class="fas fa-hospital"></i> Facility
            </label>
            <select name="facility" id="facility" class="form-control" required>
              <option value="">Select Facility</option>
              <option value="001">NPW 500 BED</option>
              <option value="002">MNMA SDG</option>
              <option value="003">Other</option>
              <option value="004">MNCWA Maternity Homes - 004</option>
            </select>
            <div class="form-text">Please select your facility from the list</div>
          </div>
    </div>

        <!-- Account Security Section -->
        <div class="form-section">
          <h5 class="section-title">
            <i class="fas fa-shield-alt"></i> Account Security
          </h5>
          
          <div class="form-group">
            <label for="password" class="form-label">
              <i class="fas fa-lock"></i> Password
            </label>
      <input name="password" id="password" type="password" class="form-control" placeholder="Create a strong password" required>
    </div>

          <div class="form-group">
            <label for="confirm" class="form-label">
              <i class="fas fa-lock"></i> Confirm Password
            </label>
      <input name="confirm" id="confirm" type="password" class="form-control" placeholder="Confirm your password" required>
    </div>
        </div>

        <button type="submit" class="btn btn-primary w-100">
          <i class="fas fa-user-plus"></i> Create Professional Account
    </button>
  </form>
  
      <!-- Message Display -->
  <div id="registerMsg"></div>
  
      <!-- Login Link -->
  <div class="text-center mt-4">
        <p style="color: var(--text-secondary); margin-bottom: 1rem;">Already have an account?</p>
    <a href="login.html" class="btn btn-outline-secondary">
          <i class="fas fa-sign-in-alt"></i> Back to Sign In
    </a>
      </div>
    </div>
  </div>

  <!-- Professional Footer -->
  <footer class="footer">
    <p>MNCH App 2025 | Developed by Jhpiego Myanmar for MoH.</p>
  </footer>
  <script>
    // Role selection styling
    document.addEventListener('DOMContentLoaded', function() {
      const roleOptions = document.querySelectorAll('.role-option');
      
      roleOptions.forEach(option => {
        const radio = option.querySelector('input[type="radio"]');
        const label = option.querySelector('label');
        
        // Handle click on the entire option
        option.addEventListener('click', function(e) {
          if (e.target !== radio) {
            radio.checked = true;
            updateRoleSelection();
          }
        });
        
        // Handle radio button change
        radio.addEventListener('change', updateRoleSelection);
      });
      
      function updateRoleSelection() {
        roleOptions.forEach(option => {
          const radio = option.querySelector('input[type="radio"]');
          if (radio.checked) {
            option.classList.add('selected');
          } else {
            option.classList.remove('selected');
          }
        });
      }
    });

    // Myanmar administrative data (exact match from JSON file)
    const myanmarRegions = {
      "Ayeyarwady Region": [
        "Bogale",
        "Danubyu",
        "Dedaye",
        "Einme",
        "Hinthada",
        "Ingapu",
        "Kangyidaunt",
        "Kyaiklat",
        "Kyangin",
        "Kyaunggon",
        "Kyonpyaw",
        "Labutta",
        "Lemyethna",
        "Maubin",
        "Mawlamyinegyun",
        "Myanaung",
        "Ngapudaw",
        "Nyaungdon",
        "Pantanaw",
        "Pathein",
        "Pyapon",
        "Thabaung",
        "Wakema",
        "Yegyi",
        "Zalun",
        "Yedashe"
      ],
      "Bago Region (East)": [
        "Bago",
        "Daik-U",
        "Htantabin",
        "Kawa",
        "Kyaukkyi",
        "Kyauktaga",
        "Nyaunglebin",
        "Oktwin",
        "Phyu",
        "Shwegyin",
        "Taungoo",
        "Thanatpin",
        "Waw",
        "Yedashe"
      ],
      "Bago Region (West)": [
        "Letpadan",
        "Minhla",
        "Monyo",
        "Nattalin",
        "Okpho",
        "Paukkaung",
        "Paungde",
        "Pyay",
        "Shwedaung",
        "Tharrawaddy",
        "Zigon"
      ],
      "Chin State": [
        "Falam",
        "Hakha",
        "Htantlang",
        "Kanpetlet",
        "Matupi",
        "Mindat",
        "Paletwa",
        "Tedim",
        "Tonzang"
      ],
      "Kachin State": [
        "Bhamo",
        "Chipwi",
        "Hpakant",
        "Hsawlaw",
        "Injangyang",
        "Kawnglanghpu",
        "Machanbaw",
        "Mansi",
        "Mogaung",
        "Mohnyin",
        "Momauk",
        "Myitkyina",
        "Puta-O",
        "Shwegu",
        "Sumprabum",
        "Tsawlaw",
        "Waingmaw"
      ],
      "Kayah State": [
        "Bawlake",
        "Demoso",
        "Hpasawng",
        "Hpruso",
        "Loikaw",
        "Mese",
        "Shadaw"
      ],
      "Kayin State": [
        "Hlaingbwe",
        "Hpa-An",
        "Hpapun",
        "Kawkareik",
        "Kyainseikgyi",
        "Myawaddy",
        "Thandaunggyi"
      ],
      "Magway Region": [
        "Aunglan",
        "Chauk",
        "Gangaw",
        "Kamma",
        "Minbu",
        "Mindon",
        "Minhla",
        "Myaing",
        "Myothit",
        "Natmauk",
        "Ngape",
        "Pakokku",
        "Pauk",
        "Pwintbyu",
        "Salin",
        "Saw",
        "Seikphyu",
        "Sidoktaya",
        "Sinbaungwe",
        "Taungdwingyi",
        "Tilin",
        "Yenangyaung",
        "Yesagyo"
      ],
      "Mandalay Region": [
        "Amarapura",
        "Aungmyaythazan",
        "Chanayethazan",
        "Chanmyathazi",
        "Kyaukpadaung",
        "Kyaukse",
        "Madaya",
        "Mahaaungmyay",
        "Mahlaing",
        "Meiktila",
        "Mogoke",
        "Myingyan",
        "Myittha",
        "Natogyi",
        "Ngazun",
        "Nyaung-U",
        "Patheingyi",
        "Pyigyidagun",
        "Pyinoolwin",
        "Singu",
        "Sintgaing",
        "Tada-U",
        "Taungtha",
        "Thazi",
        "Wundwin",
        "Yamethin"
      ],
      "Mon State": [
        "Bilin",
        "Chaungzon",
        "Kyaikmaraw",
        "Kyaikto",
        "Mawlamyine",
        "Mudon",
        "Paung",
        "Thanbyuzayat",
        "Thaton",
        "Ye"
      ],
      "Nay Pyi Taw": [
        "Dekkhinathiri",
        "Lewe",
        "Ottarathiri",
        "Pobbathiri",
        "Pyinmana",
        "Tatkon",
        "Zabuthiri"
      ],
      "Rakhine State": [
        "Ann",
        "Buthidaung",
        "Gwa",
        "Kyaukpyu",
        "Kyauktaw",
        "Maungdaw",
        "Minbya",
        "Mrauk-U",
        "Munaung",
        "Myebon",
        "Pauktaw",
        "Ponnagyun",
        "Ramree",
        "Rathedaung",
        "Sittwe",
        "Thandwe",
        "Toungup"
      ],
      "Sagaing Region": [
        "Ayadaw",
        "Banmauk",
        "Budalin",
        "Chaung-U",
        "Hkamti",
        "Homalin",
        "Indaw",
        "Kale",
        "Kani",
        "Katha",
        "Kawlin",
        "Khin-U",
        "Kyunhla",
        "Lahe",
        "Lay Shi",
        "Mawlaik",
        "Mingin",
        "Monywa",
        "Nanyun",
        "Pale",
        "Paungbyin",
        "Pinlebu",
        "Salingyi",
        "Shwebo",
        "Tabayin",
        "Tamu",
        "Taze",
        "Tigyaing",
        "Wetlet",
        "Wuntho",
        "Ye-U",
        "Yinmabin"
      ],
      "Shan State (South)": [
        "Hopong",
        "Hsiseng",
        "Kalaw",
        "Kunhing",
        "Kyaukme",
        "Kyethi",
        "Lawksawk",
        "Loilen",
        "Mawkmai",
        "Monghsu",
        "Mongkaung",
        "Mongnai",
        "Nansang",
        "Nawnghkio",
        "Pekon",
        "Pinlaung",
        "Taunggyi"
      ],
      "Shan State (North)": [
        "Hseni",
        "Kutkai",
        "Lashio",
        "Laukkaing",
        "Mabein",
        "Manton",
        "Mongmao",
        "Mongmit",
        "Mongyai",
        "Muse",
        "Namkham",
        "Namhsan",
        "Namtu",
        "Nawnghkio",
        "Pangsang",
        "Pangwaun",
        "Tangyan"
      ],
      "Shan State (East)": [
        "Kengtung",
        "Monghpyak",
        "Monghsat",
        "Mongkhet",
        "Mongla",
        "Mongping",
        "Mongton",
        "Mongyang",
        "Tachileik"
      ],
      "Tanintharyi Region": [
        "Bokpyin",
        "Dawei",
        "Kawthaung",
        "Kyunsu",
        "Launglon",
        "Myeik",
        "Palaw",
        "Tanintharyi",
        "Thayetchaung",
        "Yebyu"
      ],
      "Yangon Region": [
        "Ahlone",
        "Bahan",
        "Botataung",
        "Cocokyun",
        "Dagon",
        "Dagon Myothit (East)",
        "Dagon Myothit (North)",
        "Dagon Myothit (Seikkan)",
        "Dagon Myothit (South)",
        "Dala",
        "Dawbon",
        "Hlaing",
        "Hlaingthaya (East)",
        "Hlaingthaya (West)",
        "Hlegu",
        "Insein",
        "Kamaryut",
        "Kyauktada",
        "Kyauktan",
        "Kyeemyindaing",
        "Lanmadaw",
        "Latha",
        "Mayangone",
        "Mingaladon",
        "Mingalar Taung Nyunt",
        "North Okkalapa",
        "Pabedan",
        "Pazundaung",
        "Sanchaung",
        "Seikkyi Khanaungto",
        "Shwepyithar",
        "South Dagon",
        "South Okkalapa",
        "Tamwe",
        "Thingangyun",
        "Thaketa",
        "Thinly",
        "Yankin"
      ]
    };

    // Function to update townships based on selected region
    function updateTownships() {
      const regionSelect = document.getElementById('regionSelect');
      const townshipSelect = document.getElementById('townshipSelect');
      const selectedRegion = regionSelect.value;
      
      // Clear and disable township select
      townshipSelect.innerHTML = '<option value="">Select Township</option>';
      townshipSelect.disabled = true;
      
      if (selectedRegion && myanmarRegions[selectedRegion]) {
        // Enable township select and populate options
        townshipSelect.disabled = false;
        
        // Add township options
        myanmarRegions[selectedRegion].forEach(township => {
          const option = document.createElement('option');
          option.value = township;
          option.textContent = township;
          townshipSelect.appendChild(option);
        });
      }
    }

    const form = document.getElementById("registerForm");
    form.onsubmit = async (e) => {
      e.preventDefault();
      const submitButton = e.target.querySelector('button[type="submit"]');
      const messageDiv = document.getElementById('registerMsg');
      
      // Show loading state
      const originalButtonText = submitButton.innerHTML;
      submitButton.innerHTML = '<div class="loading"></div> Creating Account...';
      submitButton.disabled = true;
      
      // Clear previous messages
      messageDiv.textContent = '';
      messageDiv.className = '';
      
      const data = Object.fromEntries(new FormData(form));
      
      // Validate required fields
      if (!data.region || !data.township) {
        submitButton.innerHTML = originalButtonText;
        submitButton.disabled = false;
        messageDiv.innerHTML = '<div class="alert alert-danger"><i class="fas fa-exclamation-triangle me-2"></i>Please select both region and township.</div>';
        return;
      }
      
      // Validate facility field
      if (!data.facility || !['001', '002', '003', '004'].includes(data.facility)) {
        submitButton.innerHTML = originalButtonText;
        submitButton.disabled = false;
        messageDiv.innerHTML = '<div class="alert alert-danger"><i class="fas fa-exclamation-triangle me-2"></i>Please select a valid facility.</div>';
        return;
      }
      
              // Additional validation for township
        if (!data.township || data.township.trim() === '') {
        submitButton.innerHTML = originalButtonText;
        submitButton.disabled = false;
        messageDiv.innerHTML = '<div class="alert alert-danger"><i class="fas fa-exclamation-triangle me-2"></i>Township cannot be empty.</div>';
          return;
        }
        
        // Ensure township is a valid string
        if (typeof data.township !== 'string') {
        submitButton.innerHTML = originalButtonText;
        submitButton.disabled = false;
        messageDiv.innerHTML = '<div class="alert alert-danger"><i class="fas fa-exclamation-triangle me-2"></i>Township must be a valid string.</div>';
        return;
      }
      
      // Password confirmation validation
      if (data.password !== data.confirm) {
        submitButton.innerHTML = originalButtonText;
        submitButton.disabled = false;
        messageDiv.innerHTML = '<div class="alert alert-danger"><i class="fas fa-exclamation-triangle me-2"></i>Passwords do not match.</div>';
          return;
        }
        
        console.log('Registration data:', data);
        console.log('Township to save:', data.township);
        console.log('Township validation passed');
      try {
        // On registration form submit
        const cred = await firebase.auth().createUserWithEmailAndPassword(data.email, data.password);
        const userData = {
          name: data.name,
          role: data.role,
          region: data.region,
          township: data.township,
          facility_code: data.facility || "003", // Default to "003" (Other) if not provided
          phone: data.phone,
          email: data.email,
          approved: false, // Use 'approved' field to match existing login logic
          createdAt: new Date().toISOString()
        };
        
        console.log('Saving user data to Firestore:', userData);
        console.log('Township being saved:', userData.township);
        
        await firebase.firestore().collection("users").doc(cred.user.uid).set(userData);
        
        console.log('User data saved successfully');
        console.log('Verifying saved data...');
        
        // Verify the data was saved correctly
        const savedDoc = await firebase.firestore().collection("users").doc(cred.user.uid).get();
        if (savedDoc.exists) {
          const savedData = savedDoc.data();
          console.log('Verified saved data:', savedData);
          console.log('Verified township:', savedData.township);
        }
        // Show success message
        messageDiv.innerHTML = '<div class="alert alert-success"><i class="fas fa-check-circle me-2"></i>Registration successful! Your account is pending approval by a super admin.</div>';
        
        // Reset button
        submitButton.innerHTML = originalButtonText;
        submitButton.disabled = false;
        
        // Reset form
        form.reset();
        document.getElementById("townshipSelect").disabled = true;
        document.getElementById("townshipSelect").innerHTML = '<option value="">Please select a region first</option>';
        
        // Reset role selection styling
        document.querySelectorAll('.role-option').forEach(option => {
          option.classList.remove('selected');
        });
        
        // Sign out and redirect after delay
        setTimeout(() => {
          firebase.auth().signOut();
          window.location.href = "login.html";
        }, 3000);
        
      } catch (err) {
        // Reset button
        submitButton.innerHTML = originalButtonText;
        submitButton.disabled = false;
        
        console.error("Registration error:", err);
        let errorMessage = err.message;
        let alertClass = 'alert-danger';
        
        if (err.code === 'auth/email-already-in-use') {
          errorMessage = "An account with this email already exists.";
        } else if (err.code === 'auth/weak-password') {
          errorMessage = "Password is too weak. Please choose a stronger password.";
        } else if (err.code === 'auth/invalid-email') {
          errorMessage = "Please enter a valid email address.";
        } else if (err.code === 'auth/network-request-failed') {
          errorMessage = "Network error. Please check your connection.";
          alertClass = 'alert-warning';
        }
        
        messageDiv.innerHTML = `<div class="alert ${alertClass}"><i class="fas fa-exclamation-triangle me-2"></i>${errorMessage}</div>`;
      }
    };
    
    // Debug function to check form data (can be called from console)
    window.debugFormData = function() {
      const form = document.getElementById("registerForm");
      const data = Object.fromEntries(new FormData(form));
      console.log('=== DEBUG FORM DATA ===');
      console.log('Form data:', data);
      console.log('Region:', data.region);
      console.log('Township:', data.township);
      console.log('Township type:', typeof data.township);
      console.log('Township length:', data.township ? data.township.length : 'N/A');
      console.log('Township trimmed:', data.township ? data.township.trim() : 'N/A');
      console.log('=== END DEBUG ===');
    };
  </script>
</body>
</html>