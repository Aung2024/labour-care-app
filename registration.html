<!DOCTYPE html>
<html>
<head>
  <title>User Registration</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/style.css" />
</head>
<body class="container my-5">
  <h2 class="mb-4">Register New Account</h2>
  <form id="registerForm" class="mb-3">
    <div class="mb-2"><input name="name" class="form-control" placeholder="Full Name" required></div>
    <div class="mb-2">
      <select name="role" class="form-control" required>
        <option value="">Select Role</option>
        <option value="Midwife">Midwife</option>
        <option value="TMO">TMO</option>
      </select>
    </div>
    <div class="mb-2">
      <select name="township" class="form-control" required>
        <option value="">Select Township</option>
        <option value="Township A">Township A</option>
        <option value="Township B">Township B</option>
        <!-- Add more townships as needed -->
      </select>
    </div>
    <div class="mb-2"><input name="clinic" class="form-control" placeholder="Clinic Name (optional)"></div>
    <div class="mb-2"><input name="phone" class="form-control" placeholder="Phone Number" required></div>
    <div class="mb-2"><input name="email" type="email" class="form-control" placeholder="Email (optional)"></div>
    <div class="mb-2"><input name="password" type="password" class="form-control" placeholder="Password" required></div>
    <div class="mb-2"><input name="confirm" type="password" class="form-control" placeholder="Confirm Password" required></div>
    <button type="submit" class="btn btn-primary w-100">Register</button>
  </form>
  <div id="registerMsg"></div>
  <a href="login.html" class="btn btn-link">Back to Login</a>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="js/firebase.js"></script>
  <script>
    const form = document.getElementById("registerForm");
    form.onsubmit = async (e) => {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(form));
      if (data.password !== data.confirm) {
        document.getElementById("registerMsg").innerHTML = '<div class="alert alert-danger">Passwords do not match.</div>';
        return;
      }
      try {
        // On registration form submit
        const cred = await firebase.auth().createUserWithEmailAndPassword(data.email, data.password);
        await db.collection("users").doc(cred.user.uid).set({
          name: data.name,
          role: data.role,
          township: data.township,
          clinic: data.clinic || "",
          phone: data.phone,
          email: data.email,
          approved: false,
          createdAt: new Date().toISOString()
        });
        await firebase.auth().signOut();
        window.location.href = "registration-success.html";
      } catch (err) {
        document.getElementById("registerMsg").innerHTML = `<div class="alert alert-danger">${err.message}</div>`;
      }
    };
  </script>
</body>
</html>