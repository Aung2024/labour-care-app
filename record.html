
<!DOCTYPE html>
<html lang="en">
<head><meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Record Observations</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
</head>
<body class="container my-4">
<h2>üìù Record Observations</h2>
<div id="patientName" class="mb-4"></div>
<form id="recordForm">
  <h5>Woman Section</h5>
  <input name="pulse" placeholder="Pulse" class="form-control mb-2"/>
  <input name="bp" placeholder="Blood Pressure" class="form-control mb-2"/>
  <input name="temperature" placeholder="Temperature" class="form-control mb-2"/>
  <input name="urine" placeholder="Urine findings" class="form-control mb-2"/>
  <h5>Labour Progress</h5>
  <input name="contractions" placeholder="Contractions per 10 min" class="form-control mb-2"/>
  <input name="cervix" placeholder="Cervix Dilatation" class="form-control mb-2"/>
  <input name="descent" placeholder="Descent of Head" class="form-control mb-2"/>
  <h5>Medications</h5>
  <input name="oxytocin" placeholder="Oxytocin (dose/time)" class="form-control mb-2"/>
  <input name="antibiotics" placeholder="Antibiotics (dose/time)" class="form-control mb-2"/>
  <h5>Shared Decision-Making</h5>
  <textarea name="decisionNotes" placeholder="Consent Notes" class="form-control mb-2"></textarea>
  <h5>Initials</h5>
  <input name="initials" placeholder="Midwife Initials" class="form-control mb-3"/>
  <button type="submit" class="btn btn-primary">Save Observation</button>
</form>
<div id="message" class="mt-3"></div>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="js/firebase.js"></script>
<script>
  const urlParams = new URLSearchParams(window.location.search);
  const patientId = urlParams.get("patient");
  async function getPatient() {
    const doc = await db.collection("patients").doc(patientId).get();
    if (doc.exists) {
      document.getElementById("patientName").innerHTML = `<h4>üë© Patient: ${doc.data().name} (${patientId})</h4>`;
    } else {
      document.getElementById("patientName").innerHTML = '<div class="alert alert-danger">Patient not found.</div>';
      document.getElementById("recordForm").style.display = "none";
    }
  }
  getPatient();
  document.getElementById("recordForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const data = Object.fromEntries(new FormData(e.target).entries());
    data.timestamp = new Date().toISOString();
    try {
      await db.collection("patients").doc(patientId).collection("records").add(data);
      document.getElementById("message").innerHTML = '<div class="alert alert-success">‚úÖ Record saved.</div>';
      e.target.reset();
    } catch (err) {
      document.getElementById("message").innerHTML = '<div class="alert alert-danger">‚ùå Error: ' + err.message + '</div>';
    }
  });
</script>
</body></html>
